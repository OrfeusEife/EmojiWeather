<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>EMoji Weather by OrfeusEife</title>
	<head>
    <!-- Dodaj przed innymi skryptami -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<style>
        :root {
            --primary: #0066cc;
            --secondary: #0099ff;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(20, 20, 30, 0.85);
            --warning: #ff4757;
            --warning-bg: rgba(255, 71, 87, 0.15);
            --background-day: linear-gradient(135deg, #a9dfbf, #f9e79f, #f1948a, #5dade2);
            --background-night: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            --text-color-day: #222;
            --text-color-night: #f0f0f0;
            --shadow: 0 12px 40px rgba(0, 102, 204, 0.2);
            --shadow-dark: 0 12px 40px rgba(0, 0, 0, 0.4);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
			--alert-bg: #f8f9fa;

            
            /* Air quality colors */
            --aqi-1: rgba(0, 228, 0, 0.25);
            --aqi-2: rgba(255, 255, 0, 0.25);
            --aqi-3: rgba(255, 126, 0, 0.25);
            --aqi-4: rgba(255, 0, 0, 0.25);
            --aqi-5: rgba(153, 0, 76, 0.25);
            --aqi-6: rgba(126, 0, 35, 0.25);
            
            /* Futuristic neon glow */
            --glow: 0 0 8px rgba(0, 153, 255, 0.5);
            --glow-hover: 0 0 15px rgba(0, 153, 255, 0.8);
        }


        @font-face {
            font-family: 'Futuristic';
            src: url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        }

        @font-face {
            font-family: 'Readable';
            src: url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap');
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--background-day);
            min-height: 100vh;
            padding: 1rem;
            color: var(--text-color-day);
            transition: var(--transition);
            line-height: 1.6;
            margin-right: 320px; /* Zwiększone dla widgetów */
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
		
		.mobile-buttons {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
}

        /* Widgety po prawej stronie */
        .widgets-container {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 380px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    z-index: 999;
    transition: transform 0.3s ease;
}
		
		.widget-icon-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100px;
    height: 90px;
    margin-right: 8px;
}

.widget-icon-container img,
.widget-icon-container svg {
    width: 100%;
    height: 100%;
    object-fit: contain;
}
.moon-widget {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.moon-header {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.moon-phase-icon {
    font-size: 1.5rem;
    line-height: 1;
}

.moon-phase-name {
    font-size: 0.9rem;
    font-weight: 500;
}

.moon-times {
    display: flex;
    justify-content: space-between;
    margin-top: 0.3rem;
}

.moon-time {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.8rem;
}

.moon-time span:first-child {
    opacity: 0.7;
    margin-bottom: 0.2rem;
}

.sun-widget {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
	height:auto;
    padding: 10px;
    background: linear-gradient(135deg, #87CEEB, #1E90FF);
    border-radius: 10px;
    color: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.sun-timeline {
    height: 30px;
    background: linear-gradient(to right, #000428, #004e92, #000428);
    border-radius: 15px;
    position: relative;
    margin: 20px 0;
}

.sun-progress {
    height: 100%;
    width: 0%;
    background: linear-gradient(to right, #FF8C00, #FFD700);
    border-radius: 15px;
    transition: width 0.5s;
}

.sun-icon {
    position: absolute;
    top: -15px;
    left: 0%;
    transform: translateX(-50%);
    font-size: 24px;
    transition: left 0.5s;
}

.time-marks {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
}

.day-info {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
}

        .widget {
    background: var(--glass);
    backdrop-filter: blur(12px) saturate(180%);
    border-radius: var(--border-radius);
    padding: 1rem;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: var(--transition);
    color: var(--text-color-day);
}

body.night-mode .widget,
body.dark-mode .widget,
body.galaxy-mode .widget,
body.space-mode .widget {
    background: var(--glass-dark);
    box-shadow: var(--shadow-dark);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-color-night);
}

        .widget-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--primary); /* Domyślny kolor dla trybu jasnego */
}

body.night-mode .widget-header,
body.dark-mode .widget-header,
body.galaxy-mode .widget-header,
body.space-mode .widget-header,
#body.rainy-day-mode .widget-header {
    color: white !important; /* Biały kolor dla trybów ciemnych */
}

        .widget-content {
            font-size: 0.9rem;
        }

        .widget-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
        }

        .widget-label {
            opacity: 0.8;
        }

        .widget-value {
            font-weight: 500;
        }

        .moon-phase-icon {
            font-size: 2rem;
            text-align: center;
            margin: 0.5rem 0;
        }
		
		.widget-toggle {
    display: none;
    position: fixed;
    bottom: 10px;
    leftt: 10px;
    background: var(--primary);
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

        /* Theme Panel */
        .theme-panel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 200px;
    background: var(--glass);
    backdrop-filter: blur(12px);
    border-radius: var(--border-radius);
    padding: 1rem;
    box-shadow: var(--shadow);
    z-index: 1000;
    max-height: 60vh;
    overflow-y: auto;
}

        body.night-mode .theme-panel,
        body.dark-mode .theme-panel,
        body.galaxy-mode .theme-panel,
        body.space-mode .theme-panel {
            background: var(--glass-dark);
            box-shadow: var(--shadow-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.matrix-mode .theme-panel,
        body.neon-mode .theme-panel {
            background: rgba(0, 20, 0, 0.95);
            border: 1px solid var(--primary);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        .theme-panel h3 {
            margin-top: 0;
            margin-bottom: 0.8rem;
            font-size: 1rem;
            color: var(--primary);
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.night-mode .theme-panel h3,
        body.dark-mode .theme-panel h3 {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .theme-panel {
    position: fixed;
    bottom: 70px;
    right: 20px;
    width: 200px;
    background: var(--glass);
    backdrop-filter: blur(12px);
    border-radius: var(--border-radius);
    padding: 1rem;
    box-shadow: var(--shadow);
    z-index: 1000;
    max-height: 60vh;
    overflow-y: auto;
    transition: all 0.3s ease;
    transform: translateY(10px);
    opacity: 0;
    pointer-events: none;
}

.theme-panel.hidden {
    display: none;
}

.theme-panel:not(.hidden) {
    transform: translateY(0);
    opacity: 1;
    pointer-events: all;
}

.theme-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.5rem;
}

.theme-option {
    padding: 0.5rem;
    cursor: pointer;
    border-radius: 8px;
    transition: var(--transition);
    background: rgba(255,255,255,0.1);
}

.theme-option:hover {
    background: rgba(255,255,255,0.2);
}

        body.night-mode .theme-option,
        body.dark-mode .theme-option {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.matrix-mode .theme-option,
        body.neon-mode .theme-option {
            background: rgba(0, 10, 0, 0.7);
            border-color: var(--primary);
        }

        body.matrix-mode .theme-option:hover,
        body.neon-mode .theme-option:hover {
            background: rgba(0, 255, 157, 0.2);
            box-shadow: 0 0 10px var(--primary);
        }

        /* Reszta styli pozostaje bez zmian */
        body.night-mode {
            background: var(--background-night);
            color: var(--text-color-night);
        }

        /* Base Theme Modes */
        body.light-mode {
            background: #f8f9fa;
            color: #333;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            background: #121212;
            color: #e0e0e0;
            --glass: rgba(30, 30, 30, 0.9);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Special Themes */
        body.forest-mode {
            --primary: #2e8b57;
            --secondary: #3cb371;
            --glass: rgba(255, 255, 255, 0.88);
            --glass-dark: rgba(34, 139, 34, 0.25);
            --text-color-day: #1e3713;
            --text-color-night: #e0f7d4;
            background: linear-gradient(135deg, #a8e6cf, #dcedc1, #6b8e23);
        }

        body.space-mode {
            --primary: #9370db;
            --secondary: #4169e1;
            --glass: rgba(25, 25, 112, 0.9);
            --glass-dark: rgba(10, 10, 30, 0.9);
            --text-color-day: #e0e0ff;
            --text-color-night: #b0e0e6;
            background: linear-gradient(135deg, #000033, #000066, #000080);
        }

        body.desert-mode {
            --primary: #cd853f;
            --secondary: #d2691e;
            --glass: rgba(255, 248, 220, 0.92);
            --glass-dark: rgba(210, 105, 30, 0.25);
            --text-color-day: #654321;
            --text-color-night: #f5deb3;
            background: linear-gradient(135deg, #f5deb3, #d2b48c, #cd853f);
        }

        body.rainy-day-mode {
            --primary: #4682b4;
            --secondary: #5f9ea0;
            --glass: rgba(176, 196, 222, 0.92);
            --glass-dark: rgba(70, 130, 180, 0.25);
            --text-color-day: #1e3f66;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #b0c4de, #778899, #4682b4);
        }

        body.spring-mode {
            --primary: #2e8b57;
            --secondary: #3cb371;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(152, 251, 152, 0.25);
            --text-color-day: #1e5631;
            --text-color-night: #e0f7d4;
            background: linear-gradient(135deg, #98fb98, #e0f7d4, #ffb6c1);
        }

        body.summer-mode {
            --primary: #ff8c00;
            --secondary: #ff4500;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(255, 140, 0, 0.25);
            --text-color-day: #8b0000;
            --text-color-night: #fffacd;
            background: linear-gradient(135deg, #ffa07a, #ff8c00, #ff4500);
        }

        body.autumn-mode {
            --primary: #d2691e;
            --secondary: #a0522d;
            --glass: rgba(255, 248, 220, 0.92);
            --glass-dark: rgba(210, 105, 30, 0.25);
            --text-color-day: #654321;
            --text-color-night: #f5deb3;
            background: linear-gradient(135deg, #d2691e, #a0522d, #8b4513);
        }

        body.winter-mode {
            --primary: #1e5f8c;
            --secondary: #4682b4;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(173, 216, 230, 0.25);
            --text-color-day: #000080;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #e6e6fa, #add8e6, #87ceeb);
        }

        body.matrix-mode {
            --primary: #00ff41;
            --secondary: #008f11;
            --glass: rgba(0, 20, 0, 0.85);
            --glass-dark: rgba(0, 10, 0, 0.95);
            --text-color-day: #00ff41;
            --text-color-night: #00ff41;
            --text-color: #00ff41;
            --shadow: 0 0 20px rgba(0, 255, 65, 0.3);
            background: #000;
            color: #00ff41;
            font-family: 'Orbitron', monospace;
        }

        body.hubba-bubba-mode {
            --primary: #ff69b4;
            --secondary: #ff1493;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(255, 105, 180, 0.25);
            --text-color-day: #333;
            --text-color-night: #fff;
            background: linear-gradient(135deg, #ffb6c1, #ff69b4, #ff1493);
        }

        body.christmas-mode {
            --primary: #d62b2b;
            --secondary: #2b8d2b;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(214, 43, 43, 0.25);
            --text-color-day: #333;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #d62b2b, #2b8d2b, #f5f5f5);
        }

        body.easter-mode {
            --primary: #8a2be2;
            --secondary: #9932cc;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(138, 43, 226, 0.25);
            --text-color-day: #4b0082;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #ff9ff3, #feca57, #1dd1a1);
        }

        body.birthday-mode {
            --primary: #ff6b6b;
            --secondary: #48dbfb;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(255, 107, 107, 0.25);
            --text-color-day: #333;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #ff6b6b, #48dbfb, #feca57);
        }

        body.disco-mode {
            --primary: #9b59b6;
            --secondary: #3498db;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(155, 89, 182, 0.25);
            --text-color-day: #2c3e50;
            --text-color-night: #ecf0f1;
            background: linear-gradient(135deg, #9b59b6, #3498db, #e74c3c);
        }

        body.ocean-mode {
            --primary: #1abc9c;
            --secondary: #3498db;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(26, 188, 156, 0.25);
            --text-color-day: #2c3e50;
            --text-color-night: #ecf0f1;
            background: linear-gradient(135deg, #1abc9c, #3498db, #9b59b6);
        }

        body.sunset-mode {
            --primary: #e74c3c;
            --secondary: #f39c12;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(231, 76, 60, 0.25);
            --text-color-day: #2c3e50;
            --text-color-night: #ecf0f1;
            background: linear-gradient(135deg, #e74c3c, #f39c12, #9b59b6);
        }

        body.neon-mode {
            --primary: #00ff9d;
            --secondary: #00b8ff;
            --glass: rgba(20, 20, 30, 0.92);
            --glass-dark: rgba(0, 0, 10, 0.95);
            --text-color-day: #00ff9d;
            --text-color-night: #00ff9d;
            --text-color: #00ff9d;
            --shadow: 0 0 20px rgba(0, 255, 157, 0.3);
            background: #000;
            color: #00ff9d;
            font-family: 'Orbitron', monospace;
        }

        body.retro-mode {
            --primary: #ff6b6b;
            --secondary: #5f27cd;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(255, 107, 107, 0.25);
            --text-color-day: #5f27cd;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #1dd1a1);
        }

        body.galaxy-mode {
            --primary: #9370db;
            --secondary: #4169e1;
            --glass: rgba(20, 20, 40, 0.92);
            --glass-dark: rgba(0, 0, 20, 0.95);
            --text-color-day: #e0e0ff;
            --text-color-night: #e0e0ff;
            --shadow: 0 0 20px rgba(147, 112, 219, 0.3);
            background: linear-gradient(135deg, #000033, #000066, #000080);
            font-family: 'Orbitron', monospace;
        }

        body.candy-mode {
            --primary: #ff9ff3;
            --secondary: #feca57;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(255, 159, 243, 0.25);
            --text-color-day: #5f27cd;
            --text-color-night: #f0f8ff;
            background: linear-gradient(135deg, #ff9ff3, #feca57, #1dd1a1);
        }

        body.monochrome-mode {
            --primary: #555;
            --secondary: #999;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(85, 85, 85, 0.25);
            --text-color-day: #333;
            --text-color-night: #f5f5f5;
            background: linear-gradient(135deg, #eee, #ccc, #aaa);
        }

        body.amber-mode {
            --primary: #ff7f50;
            --secondary: #ff6347;
            --glass: rgba(255, 255, 255, 0.96);
            --glass-dark: rgba(255, 127, 80, 0.25);
            --text-color-day: #333;
            --text-color-night: #f5f5f5;
            background: linear-gradient(135deg, #ff7f50, #ff8c00, #ff6347);
        }

        body.dzik-mode {
            --primary: #ff0000;
            --secondary: #000000;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(0, 0, 0, 0.85);
            --text-color-day: #000000;
            --text-color-night: #ffffff;
            --text-color: #000000;
            --shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            background: linear-gradient(135deg, #000000, #ff0000, #ffffff);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: var(--glass);
            backdrop-filter: blur(12px) saturate(180%);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        body.night-mode .container,
        body.dark-mode .container,
        body.galaxy-mode .container,
        body.space-mode .container {
            background: var(--glass-dark);
            box-shadow: var(--shadow-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .container {
            background: rgba(255, 255, 255, 0.98);
            color: #333;
        }

        body.matrix-mode .container,
        body.neon-mode .container,
        body.galaxy-mode .container,
        body.dzik-mode .container {
            border: 1px solid var(--primary);
            box-shadow: var(--shadow);
        }

        /* Typography */
        h1, h2, h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 700;
            line-height: 1.3;
        }

        h1 {
            font-size: 2.2rem;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 1.8rem;
        }

        h3 {
            font-size: 1.4rem;
        }

        body.matrix-mode h1,
        body.matrix-mode h2,
        body.matrix-mode h3,
        body.neon-mode h1,
        body.neon-mode h2,
        body.neon-mode h3,
        body.galaxy-mode h1,
        body.galaxy-mode h2,
        body.galaxy-mode h3 {
            color: var(--primary);
            text-shadow: 0 0 8px var(--primary);
            font-family: 'Orbitron', monospace;
            font-weight: 500;
        }

        body.night-mode h1,
        body.night-mode h2,
        body.night-mode h3,
        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3 {
            color: var(--secondary);
        }

        /* Search Box */
        .search-box {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        input {
            padding: 0.8rem 1.2rem;
            border: 1px solid var(--primary);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            flex: 1;
            min-width: 200px;
            background: rgba(255, 255, 255, 0.92);
            color: var(--text-color-day);
            transition: var(--transition);
            box-shadow: var(--glow);
        }

        input:focus {
            outline: none;
            box-shadow: var(--glow-hover);
            border-color: var(--secondary);
        }

        body.night-mode input,
        body.dark-mode input,
        body.galaxy-mode input,
        body.space-mode input {
            background: rgba(10, 10, 20, 0.7);
            color: var(--text-color-night);
            border-color: var(--secondary);
        }

        body.light-mode input {
            background: rgba(255, 255, 255, 0.98);
            color: #333;
            border-color: #0066cc;
        }

        body.matrix-mode input,
        body.neon-mode input {
            background: rgba(0, 10, 0, 0.8);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Buttons */
         button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
            box-shadow: var(--glow);
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-hover);
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        button:hover::after {
            left: 100%;
        }

        body.matrix-mode button,
        body.neon-mode button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Theme Toggle */
        .theme-toggle {
		
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--glass);
    backdrop-filter: blur(12px);
    border-radius: var(--border-radius);
    padding: 0.8rem 1.2rem;
    cursor: pointer;
    z-index: 1001;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,0.2);
}
        }

        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: rotate(15deg);
        }

        body.matrix-mode .theme-toggle,
        body.neon-mode .theme-toggle {
            background: rgba(0, 255, 157, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Theme Selector */
        .theme-selector {
            position: absolute;
            top: 20px;
            right: 80px;
            background: var(--glass);
            border-radius: var(--border-radius);
            padding: 0.8rem;
            border: 1px solid var(--primary);
            color: var(--text-color-day);
            box-shadow: var(--shadow);
            z-index: 100;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            width: 320px;
        }

        body.night-mode .theme-selector,
        body.dark-mode .theme-selector,
        body.galaxy-mode .theme-selector,
        body.space-mode .theme-selector {
            background: var(--glass-dark);
            color: var(--text-color-night);
        }

        body.matrix-mode .theme-selector,
        body.neon-mode .theme-selector {
            background: rgba(0, 20, 0, 0.95);
            color: var(--primary);
            border-color: var(--primary);
        }

        .theme-option {
            padding: 0.6rem;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.8rem;
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .theme-option:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        body.matrix-mode .theme-option:hover,
        body.neon-mode .theme-option:hover {
            background: rgba(0, 255, 157, 0.2);
            box-shadow: 0 0 10px var(--primary);
        }

        /* Cards */
        .card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.92), rgba(245, 249, 255, 0.92));
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        body.night-mode .card,
        body.dark-mode .card,
        body.galaxy-mode .card,
        body.space-mode .card {
            background: linear-gradient(145deg, rgba(20, 20, 30, 0.8), rgba(30, 30, 47, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(245, 249, 255, 0.98));
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.matrix-mode .card,
        body.neon-mode .card {
            background: rgba(0, 10, 0, 0.85);
            border: 1px solid var(--primary);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        /* Warning Cards */
        .warning-card {
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 6px solid;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .warning-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .warning-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .warning-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .warning-title {
            font-weight: 700;
            font-size: 1.6rem;
            color: inherit;
            margin: 0;
        }

        .warning-severity {
            font-size: 0.95em;
            opacity: 0.9;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .warning-details {
            font-size: 1.15rem;
            line-height: 1.7;
            margin: 1.5rem 0;
            white-space: pre-line;
        }

        .warning-time {
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.08);
            padding: 1.2rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .warning-time-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
        }

        .warning-sources {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed rgba(0, 0, 0, 0.15);
        }

        body.night-mode .warning-sources,
        body.dark-mode .warning-sources {
            border-top-color: rgba(255, 255, 255, 0.15);
        }

        /* Warning Colors */
        .warning-card.yellow {
            border-left-color: #ffcc00;
            background: rgba(255, 204, 0, 0.15);
        }

        .warning-card.orange {
            border-left-color: #ff9500;
            background: rgba(255, 149, 0, 0.15);
        }

        .warning-card.red {
            border-left-color: #ff3b30;
            background: rgba(255, 59, 48, 0.15);
        }

        .warning-card.hydro {
            border-left-color: #1e90ff;
            background: rgba(30, 144, 255, 0.15);
        }

        .warning-card.hydro.red {
            border-left-color: #ff3b30;
            background: rgba(255, 59, 48, 0.15);
        }

        /* Weather Elements */
        .weather-icon {
            font-size: 4rem;
            margin: 1.5rem 0;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .weather-icon img {
            width: 80px;
            height: 70px;
            transition: var(--transition);
        }

        .weather-icon img:hover {
            transform: scale(1.15) rotate(5deg);
        }

        .current-condition {
            font-size: 1.3rem;
            margin: 1rem 0;
            color: var(--text-color-day);
            font-weight: 500;
        }

        body.night-mode .current-condition,
        body.dark-mode .current-condition,
        body.galaxy-mode .current-condition,
        body.space-mode .current-condition {
            color: var(--text-color-night);
        }

        body.matrix-mode .current-condition,
        body.neon-mode .current-condition {
            color: var(--primary);
        }

        /* Parameter Grid */
        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .parameter-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 102, 204, 0.2);
            backdrop-filter: blur(5px);
            transition: var(--transition);
        }

        .parameter-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 102, 204, 0.15);
        }

        body.night-mode .parameter-item,
        body.dark-mode .parameter-item,
        body.galaxy-mode .parameter-item,
        body.space-mode .parameter-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .parameter-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.matrix-mode .parameter-item,
        body.neon-mode .parameter-item {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .parameter-label {
            font-size: 0.95em;
            opacity: 0.9;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        body.matrix-mode .parameter-label,
        body.neon-mode .parameter-label {
            color: var(--primary);
        }

        .parameter-value {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.4em;
            animation: pulse 2s infinite;
        }

        body.night-mode .parameter-value,
        body.dark-mode .parameter-value,
        body.galaxy-mode .parameter-value,
        body.space-mode .parameter-value {
            color: var(--secondary);
        }

        body.matrix-mode .parameter-value,
        body.neon-mode .parameter-value {
            color: var(--primary);
            text-shadow: 0 0 8px var(--primary);
        }

        /* Hourly Forecast */
        .hourly-forecast {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .hour-item {
            padding: 1.5rem;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            min-width: 120px;
            transition: var(--transition);
        }

        .hour-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body.night-mode .hour-item,
        body.dark-mode .hour-item,
        body.galaxy-mode .hour-item,
        body.space-mode .hour-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .hour-item {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.matrix-mode .hour-item,
        body.neon-mode .hour-item {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        /* Forecast Container */
        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* Temperature Extremes */
        .temp-extremes {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            font-size: 1rem;
            gap: 1rem;
        }

        .temp-max { 
            color: #e74c3c;
            font-weight: 600;
        }
        
        .temp-min { 
            color: #3498db;
            font-weight: 600;
        }

        body.matrix-mode .temp-max,
        body.neon-mode .temp-max { 
            color: #ff0000;
            text-shadow: 0 0 5px #ff0000;
        }
        
        body.matrix-mode .temp-min,
        body.neon-mode .temp-min { 
            color: #00a3ff;
            text-shadow: 0 0 5px #00a3ff;
        }

        /* Sun Times */
        .sun-times {
            display: flex;
            gap: 1.5rem;
            margin-top: 1.5rem;
            font-size: 1rem;
            color: var(--text-color-day);
            flex-wrap: wrap;
        }

        body.night-mode .sun-times,
        body.dark-mode .sun-times,
        body.galaxy-mode .sun-times,
        body.space-mode .sun-times {
            color: var(--text-color-night);
        }

        body.matrix-mode .sun-times,
        body.neon-mode .sun-times {
            color: var(--primary);
        }

        /* Air Quality */
        .air-quality-advice {
            margin-top: 1.5rem;
            font-size: 1rem;
            color: var(--text-color-day);
            padding: 1.2rem;
            border-radius: var(--border-radius);
        }

        body.night-mode .air-quality-advice,
        body.dark-mode .air-quality-advice,
        body.galaxy-mode .air-quality-advice,
        body.space-mode .air-quality-advice {
            color: var(--text-color-night);
        }

        body.matrix-mode .air-quality-advice,
        body.neon-mode .air-quality-advice {
            color: var(--primary);
        }

        .air-quality-emoji {
            font-size: 2.5em;
            margin: 0.5rem 0;
            display: inline-block;
            transition: transform 0.3s ease;
        }

        .air-quality-emoji:hover {
            transform: scale(1.2) rotate(10deg);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        body.matrix-mode .loading,
        body.neon-mode .loading {
            border-top-color: var(--primary);
        }

        /* Special Cards */
        .weather-summary {
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .weather-summary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body.night-mode .weather-summary,
        body.dark-mode .weather-summary,
        body.galaxy-mode .weather-summary,
        body.space-mode .weather-summary {
            background: rgba(0, 0, 0, 0.4);
            border-left-color: var(--secondary);
        }

        body.light-mode .weather-summary {
            background: rgba(255, 255, 255, 0.95);
            border-left-color: var(--primary);
        }

        body.matrix-mode .weather-summary,
        body.neon-mode .weather-summary {
            background: rgba(0, 0, 0, 0.6);
            border-left-color: var(--primary);
        }

        .runner-tip {
            background: rgba(0, 102, 204, 0.15);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 2rem;
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .runner-tip:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body.night-mode .runner-tip,
        body.dark-mode .runner-tip,
        body.galaxy-mode .runner-tip,
        body.space-mode .runner-tip {
            background: rgba(0, 153, 255, 0.15);
            border-left-color: var(--secondary);
            color: var(--text-color-night);
        }

        body.light-mode .runner-tip {
            background: rgba(0, 102, 204, 0.2);
            border-left-color: var(--primary);
        }

        body.matrix-mode .runner-tip,
        body.neon-mode .runner-tip {
            background: rgba(0, 255, 65, 0.15);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        /* Air Quality Index Colors */
        .aqi-1 { 
            background: var(--aqi-1) !important; 
            border-left-color: #00e400 !important; 
        }
        
        .aqi-2 { 
            background: var(--aqi-2) !important; 
            border-left-color: #ffff00 !important; 
        }
        
        .aqi-3 { 
            background: var(--aqi-3) !important; 
            border-left-color: #ff7e00 !important; 
        }
        
        .aqi-4 { 
            background: var(--aqi-4) !important; 
            border-left-color: #ff0000 !important; 
        }
        
        .aqi-5 { 
            background: var(--aqi-5) !important; 
            border-left-color: #99004c !important; 
        }
        
        .aqi-6 { 
            background: var(--aqi-6) !important; 
            border-left-color: #7e0023 !important; 
        }

        /* Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* Mobile Responsiveness */
 @media (max-width: 992px) {
            body {
                margin-right: 0;
                padding-bottom: 80px;
            }
            
            .theme-panel {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 20px;
                top: auto;
                max-height: 150px;
            }
            
            .theme-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .search-box {
                flex-direction: row;
                gap: 0.8rem;
            }
            
            input {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .theme-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .container {
                padding: 1rem;
            }
			.widgets-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        width: auto;
        flex-direction: row;
        overflow-x: auto;
        padding: 10px;
        background: var(--glass);
        height: 90%;
    }
    
    .widget {
        min-width: 80%;
        margin-right: 10px;
    }
    
    body {
        padding-bottom: 180px;
    }
    
    .container {
        margin-top: 20px;
    }
        }
		
		@media (max-width: 576px) {
    .widget-toggle {
        display: block;
		left: 10px;
    }
    
    .widgets-container {
        display: none;
        position: absolute;;
        bottom: 50px;
        left: 0;
        right: 0;
        background: var(--glass);
        padding: 10px;
        z-index: 999;
    }
    
    .widgets-container.visible {
        display: grid;
        grid-template-columns: 1fr;
    }
	widget {
        padding: 8px;
    }
    
    .widget-header {
        font-size: 0.9rem;
    }
    
    .widget-row {
        font-size: 0.8rem;
    }
    
    .moon-phase-icon {
        font-size: 1.5rem;
    }
}


        @media (max-width: 480px) {
            .theme-panel {
                width: calc(100% - 20px);
                right: 10px;
                bottom: 10px;
            }
            
            .theme-options {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                flex-direction: column;
                gap: 0.6rem;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
			.mobile-buttons {
        flex-direction: row; /* Upewnij się, że na mobile też są obok siebie */
    }
	/* Style wspólne dla wszystkich widgetów */
.widget {
    background: var(--glass);
    border-radius: var(--border-radius);
    padding: 1rem;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.2);
    margin-bottom: 1rem;
}

body.night-mode .widget,
body.dark-mode .widget {
    background: var(--glass-dark);
    border-color: rgba(255, 255, 255, 0.1);
}

.widget-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--primary);
}

.widget-content {
    font-size: 0.9rem;
    line-height: 1.5;
}

.widget-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.3rem;
}

.widget-label {
    opacity: 0.8;
}

.widget-value {
    font-weight: 500;
}

.widget-note {
    font-size: 0.7rem;
    opacity: 0.7;
    margin-top: 0.5rem;
    border-top: 1px dashed rgba(0,0,0,0.1);
    padding-top: 0.5rem;
}

body.night-mode .widget-note {
    border-top-color: rgba(255,255,255,0.1);
}

/* Style specyficzne dla poszczególnych widgetów */



/* Widget Prognoza Opadów */
#precipitationWidget {
    border-left: 4px solid var(--secondary);
}

.precipitation-item {
    margin-bottom: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
}

body.night-mode .precipitation-item {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

/* Widget Ostrzeżenie Burzowe */
#stormWidget {
    border-left: 4px solid var(--warning);
}

.storm-warning {
    color: var(--warning);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.storm-alert {
    background-color: var(--warning-bg);
    padding: 0.5rem;
    border-radius: 6px;
    margin: 0.5rem 0;
    font-weight: 500;
}

.storm-recommendations {
    font-size: 0.8rem;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px dashed rgba(0, 0, 0, 0.1);
}

body.night-mode .storm-recommendations {
    border-top-color: rgba(255, 255, 255, 0.1);
}


/* Style dla widgetu opadów */
.precipitation-chart-container {
    position: relative;
    height: 120px;
    margin-bottom: 10px;
}

.precipitation-summary {
    font-size: 0.85rem;
    line-height: 1.4;
    padding-top: 8px;
    border-top: 1px dashed rgba(0,0,0,0.2);
}

body.night-mode .precipitation-summary {
    border-top-color: rgba(255,255,255,0.2);
}
.precipitation-period {
    margin-bottom: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px dashed rgba(0,0,0,0.1);
}

body.night-mode .precipitation-period {
    border-bottom-color: rgba(255,255,255,0.1);
}
/* Widget Przymrozki */
#frostWidget {
    border-left: 4px solid #3498db;
}

.frost-warning {
    color: #3498db;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.frost-alert {
    background-color: rgba(52, 152, 219, 0.15);
    padding: 0.5rem;
    border-radius: 6px;
    margin: 0.5rem 0;
    font-weight: 500;
}

.frost-details {
    margin: 0.5rem 0;
    padding: 0.5rem;
    background-color: rgba(52, 152, 219, 0.05);
    border-radius: 6px;
}

.frost-advice {
    font-size: 0.8rem;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px dashed rgba(0,0,0,0.1);
}

body.night-mode .frost-advice {
    border-top-color: rgba(255,255,255,0.1);
}

/* Widget Temperatura */
.temperature-chart-container {
    position: relative;
    height: 150px;
    margin-bottom: 5px;
}


    </style>
</head>
<body>
<div class="widgets-container">
        <div class="widget" id="currentWeatherWidget">
            <div class="widget-header">
                <span>⛅</span>
                <span>Aktualna pogoda</span>
            </div>
            <div class="widget-content">
			<center><span class="widget-icon-container" id="widgetIcon"></span></center>
			<div class="widget-row">
                    <span class="widget-label">Warunki:</span>
                    <span class="widget-value" id="widgetCondition">-</span>
                </div>
                <div class="widget-row">
                    <span class="widget-label">Temperatura:</span>
                    <span class="widget-value" id="widgetTemp">-</span>
                </div>
                <div class="widget-row">
                    <span class="widget-label">Wiatr:</span>
                    <span class="widget-value" id="widgetWind">-</span>
                </div>
                <div class="widget-row">
                    <span class="widget-label">Wilgotność:</span>
                    <span class="widget-value" id="widgetHumidity">-</span>
                </div>
            </div>
        </div>

        <div class="sun-widget">
                <span>☀️ Długość dnia</span>
    <div class="sun-timeline">
       <div class="sun-progress" id="sunPosition"></div>
        <div class="sun-icon">☀️</div>
        <div class="time-marks">
            <span class="sunrise-mark"><span class="time-label">Wschód:</span> <span id="widgetSunrise">-</span></span>
            <span class="sunset-mark"><span class="time-label">Zachód:</span> <span id="widgetSunset">-</span></span>
        </div>
    </div>
    <div class="day-info">
        <span id="widgetDayLength">-</span>
        <span id="dayDifference">-</span>
    </div>
</div>

        <div class="widget moon-widget">
		<span>Faza Księżyca 🌙</span>
    <div class="moon-header">
        <div class="moon-phase-icon" id="moonPhaseIcon"></div>
        <div class="moon-phase-name" id="moonPhase"></div>
    </div>
    <div class="moon-times">
        <div class="moon-time">
            <span>Wschód</span>
            <span id="moonrise">-</span>
        </div>
        <div class="moon-time">
            <span>Zachód</span>
            <span id="moonset">-</span>
        </div>
    </div>
</div>


        
	   

<div class="widget" id="precipitationWidget">
        <div class="widget-header">
            <span>🌧️</span>
            <span>Prognoza opadów</span>
        </div>
        <div class="widget-content">
            <div class="precipitation-chart-container">
                <canvas id="precipitationChart"></canvas>
            </div>
            <div class="precipitation-summary" id="precipitationSummary">
                Ładowanie danych o opadach...
            </div>
        </div>
    </div>
<div class="widget" id="temperatureWidget">
    <div class="widget-header">
        <span>🌡️</span>
        <span>Prognoza Temperatury</span>
    </div>
    <div class="widget-content">
        <div class="temperature-chart-container">
            <canvas id="temperatureChart"></canvas>
        </div>
    </div>
</div>

<div class="widget" id="alertsWidget">
            <div class="widget-header">
                <span>⚠️</span>
                <span>Ostrzeżenia</span>
            </div>
            <div class="widget-content" id="widgetAlerts">
                Brak aktywnych ostrzeżeń
            </div>
		
       </div>

<div class="widget" id="stormWidget">
    <div class="widget-header">
        <span>⚡</span>
        <span>Ostrzeżenie burzowe</span>
    </div>
    <div class="widget-content" id="stormContent">
        Brak burz w prognozie
    </div>
</div>
<div class="widget" id="frostWidget">
        <div class="widget-header">
            <span>❄️</span>
            <span>Ostrzeżenie o przymrozkach</span>
        </div>
        <div class="widget-content" id="frostContent">
            Ładowanie danych o przymrozkach...
        </div>
    </div>
</div>
	
	
    <div class="container">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <h1 style="margin: 0;">EMoji Weather by OrfeusEife</h1>
            <div class="theme-toggle" id="themeToggle" title="Zmień motyw">
                🌓
            </div>
        </div>
        
        <div class="search-box">
    <input type="text" id="locationInput" placeholder="Wpisz nazwę miasta..." onkeypress="handleEnter(event)">
    <div class="mobile-buttons">
        <button onclick="searchLocation()">🔍 Szukaj</button>
        <button onclick="getLocation()">🌍 Moja lokalizacja</button>
    </div>
    <div id="loadingIndicator" style="display:none; align-items:center; gap:0.5rem;">
        <span class="loading"></span> Ładowanie...
    </div>
</div>

        <div id="weatherSummary" class="weather-summary" style="display: none;">
            <h3>Komunikat meteo</h3>
            <div id="weatherSummaryText"></div>
        </div>

        <div id="runnerTip" class="runner-tip" style="display: none;">
            <h3>💡 Porada dla biegacza</h3>
            <div id="runnerTipText"></div>
        </div>

        <div class="current-weather">
            <div class="card">
                <h2 id="currentCity">Ładowanie lokalizacji...</h2>
                <div class="weather-icon" id="currentIcon"></div>
                <div class="current-condition" id="currentCondition">-</div>
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <span>🌡️</span>
                        <div>
                            <div class="parameter-label">Temperatura</div>
                            <div class="parameter-value" id="tempNow">-</div>
                        </div>
                    </div>
                    <div class="parameter-item">
                        <span>💨</span>
                        <div>
                            <div class="parameter-label">Wiatr</div>
                            <div class="parameter-value" id="windNow">-</div>
                        </div>
                    </div>
                    <div class="parameter-item">
                        <span>🎚️</span>
                        <div>
                            <div class="parameter-label">Ciśnienie</div>
                            <div class="parameter-value" id="pressureNow">-</div>
                        </div>
                    </div>
                    <div class="parameter-item">
                        <span>💧</span>
                        <div>
                            <div class="parameter-label">Wilgotność</div>
                            <div class="parameter-value" id="humidityNow">-</div>
                        </div>
						
                    </div>
					
                </div>
				<div class="sun-times" id="sunTimes">
                    <span>🌅 Wschód słońca: <span id="sunriseTime">-</span></span>
                    <span>🌇 Zachód słońca: <span id="sunsetTime">-</span></span>
                </div>
            </div>

            <div class="card">
                <h3>Jakość powietrza</h3>
                <div class="parameter-grid">
                    <div class="parameter-item" id="aqiItem">
                        <span>🌫️</span>
                        <div>
                            <div class="parameter-label">AQI</div>
                            <div class="parameter-value" id="aqiValue">-</div>
                        </div>
                    </div>
                    <div class="parameter-item">
                        <span>💨</span>
                        <div>
                            <div class="parameter-label">PM2.5</div>
                            <div class="parameter-value" id="pm25Value">-</div>
                        </div>
                    </div>
                    <div class="parameter-item">
                        <span>🌪️</span>
                        <div>
                            <div class="parameter-label">PM10</div>
                            <div class="parameter-value" id="pm10Value">-</div>
                        </div>
                    </div>
                </div>
                <div class="air-quality-advice" id="airQualityAdvice"></div>
            </div>
        </div>

        <div class="card">
            <h3>Prognoza na najbliższe godziny</h3>
            <div class="hourly-forecast" id="hourlyForecast">
                <div class="hour-item">Ładowanie danych...</div>
            </div>
        </div>

        <div class="card">
            <h3>Prognoza na 3 dni</h3>
            <div class="forecast-container" id="forecast">
                <div class="card">Ładowanie danych...</div>
            </div>
        </div>

        <div class="card">
            <h3>Ostrzeżenia pogodowe</h3>
            <div id="weatherWarnings">
                <div class="warning-card">
                    <div class="warning-header">
                        <span class="warning-icon">⚠️</span>
                        <span class="warning-title">Ładowanie ostrzeżeń...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cache DOM elements
        const weatherElements = {
            currentCity: document.getElementById('currentCity'),
            currentCondition: document.getElementById('currentCondition'),
            tempNow: document.getElementById('tempNow'),
            windNow: document.getElementById('windNow'),
            pressureNow: document.getElementById('pressureNow'),
            humidityNow: document.getElementById('humidityNow'),
            sunriseTime: document.getElementById('sunriseTime'),
            sunsetTime: document.getElementById('sunsetTime'),
            airQualityAdvice: document.getElementById('airQualityAdvice'),
            aqiValue: document.getElementById('aqiValue'),
            aqiItem: document.getElementById('aqiItem'),
            pm25Value: document.getElementById('pm25Value'),
            pm10Value: document.getElementById('pm10Value'),
            currentIcon: document.getElementById('currentIcon'),
            hourlyForecast: document.getElementById('hourlyForecast'),
            forecast: document.getElementById('forecast'),
            weatherWarnings: document.getElementById('weatherWarnings'),
            locationInput: document.getElementById('locationInput'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            weatherSummary: document.getElementById('weatherSummary'),
            weatherSummaryText: document.getElementById('weatherSummaryText'),
            runnerTip: document.getElementById('runnerTip'),
            runnerTipText: document.getElementById('runnerTipText'),
            themeToggle: document.getElementById('themeToggle')
        };

        const API_KEY = 'd0c0831962dc429f91771349242705';
        const TRANSLATE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbznFB7otJiVr5HS-L1il3FiWEYNsWxDypy5MxAU47UA1-RAkDmvuvsoPQj9J8MiikR0PQ/exec';
        
        const WARNING_TYPES = {
            'storm': { emoji: '⛈️', name: 'Burza', description: 'Burze z intensywnymi wyładowaniami atmosferycznymi', severity: 'orange' },
            'rain': { emoji: '🌧️', name: 'Ulewny deszcz', description: 'Intensywne opady deszczu', severity: 'yellow' },
            'wind': { emoji: '💨', name: 'Silny wiatr', description: 'Porywisty wiatr o dużej sile', severity: 'yellow' },
            'snow': { emoji: '❄️', name: 'Opady śniegu', description: 'Śnieg powodujący utrudnienia', severity: 'yellow' },
            'fog': { emoji: '🌫️', name: 'Gęsta mgła', description: 'Znaczne ograniczenie widoczności', severity: 'yellow' },
            'heat': { emoji: '🔥', name: 'Upał', description: 'Wysokie temperatury stanowiące zagrożenie', severity: 'orange' },
            'cold': { emoji: '🥶', name: 'Silny mróz', description: 'Niskie temperatury stanowiące zagrożenie', severity: 'orange' },
            'flood': { emoji: '🌊', name: 'Powódź', description: 'Wezbrania wód i podtopienia', severity: 'red' },
            'fire': { emoji: '🔥', name: 'Zagrożenie pożarowe', description: 'Wysokie ryzyko pożarów', severity: 'red' },
            'frost': { emoji: '❄️', name: 'Przymrozki', description: 'Temperatury spadające poniżej zera', severity: 'yellow' },
            'watch': { emoji: '👀', name: 'Monitorowanie', description: 'Warunki sprzyjające rozwojowi zagrożenia', severity: 'yellow' },
            'warning': { emoji: '⚠️', name: 'Ostrzeżenie', description: 'Zagrożenie aktualne lub nadchodzące', severity: 'orange' }
        };
		
		function translateWeatherCondition(code, isDay) {
    const translation = WEATHER_CODE_TRANSLATIONS[code] || 
                      { day: "Warunki pogodowe", night: "Warunki pogodowe" };
    
    const emoji = getWeatherEmoji(code, isDay);
    return `${emoji} ${isDay ? translation.day : translation.night}`;
}

function getWeatherEmoji(code, isDay) {
    const emojiMap = {
        1000: isDay ? '☀️' : '🌙',
        1003: isDay ? '⛅' : '☁️',
        1006: '☁️',
        1009: '☁️',
        1030: '🌫️',
        1135: '🌁',
        1147: '🌫️',
        // ... i tak dalej dla innych kodów
        1276: '⛈️',
        1282: '❄️⚡'
    };
    return emojiMap[code] || '🌀';
}


function translateWeatherCondition(code, isDay) {
    try {
        if (!code) return "Brak danych pogodowych";
        
        const translation = WEATHER_CODE_TRANSLATIONS[code];
        if (!translation) {
            console.warn(`Nieznany kod pogodowy: ${code}`);
            return "Warunki pogodowe";
        }
        
        return isDay ? translation.day : translation.night;
    } catch (e) {
        console.error('Błąd tłumaczenia warunków pogodowych:', e);
        return "Warunki pogodowe";
    }
}
		
		const WEATHER_CODE_TRANSLATIONS = {
    // Sunny/Clear
    1000: { day: "Słonecznie", night: "Bezchmurnie" },
    
    // Partly cloudy
    1003: { day: "Częściowe zachmurzenie", night: "Częściowe zachmurzenie" },
    
    // Cloudy/Overcast
    1006: { day: "Pochmurno", night: "Pochmurno" },
    1009: { day: "Zachmurzenie całkowite", night: "Zachmurzenie całkowite" },
    
    // Fog/Mist
    1030: { day: "Lekka mgła", night: "Lekka mgła" },
    1135: { day: "Mgła", night: "Mgła" },
    1147: { day: "Marznąca mgła/Szadź", night: "Marznąca mgła/Szadź" },
    
    // Rain
    1063: { day: "Przelotne opady deszczu", night: "Przelotne opady deszczu" },
    1072: { day: "Przelotna marznąca mżawka", night: "Przelotna marznąca mżawka" },
    1150: { day: "Przelotna mżawka", night: "Przelotna mżawka" },
    1153: { day: "Lekka mżawka", night: "Lekka mżawka" },
    1168: { day: "Marznąca mżawka", night: "Marznąca mżawka" },
    1171: { day: "Silna marznąca mżawka", night: "Silna marznąca mżawka" },
    1180: { day: "Miejscowy lekki deszcz", night: "Miejscowy lekki deszcz" },
    1183: { day: "Lekki deszcz", night: "Lekki deszcz" },
    1186: { day: "Umiarkowany deszcz, przejaśnienia", night: "Umiarkowany deszcz, przejaśnienia" },
    1189: { day: "Umiarkowany deszcz", night: "Umiarkowany deszcz" },
    1192: { day: "Ulewny deszcz, przejaśnienia", night: "Ulewny deszcz, przejaśnienia" },
    1195: { day: "Ulewny deszcz", night: "Ulewny deszcz" },
    1198: { day: "Lekki marznący deszcz", night: "Lekki marznący deszcz" },
    1201: { day: "Umiarkowany/mocny marznący deszcz", night: "Umiarkowany/mocny marznący deszcz" },
    1240: { day: "Lekki przelotny deszcz", night: "Lekki przelotny deszcz" },
    1243: { day: "Umiarkowany/mocny przelotny deszcz", night: "Umiarkowany/mocny przelotny deszcz" },
    1246: { day: "Gwałtowna ulewa", night: "Gwałtowna ulewa" },
    
    // Snow
    1066: { day: "Przelotne opady śniegu", night: "Przelotne opady śniegu" },
    1114: { day: "Zawieja śnieżna", night: "Zawieja śnieżna" },
    1117: { day: "Zamieć śnieżna", night: "Zamieć śnieżna" },
    1210: { day: "Przelotny lekki śnieg", night: "Przelotny lekki śnieg" },
    1213: { day: "Lekki śnieg", night: "Lekki śnieg" },
    1216: { day: "Przelotny umiarkowany śnieg", night: "Przelotny umiarkowany śnieg" },
    1219: { day: "Umiarkowany śnieg", night: "Umiarkowany śnieg" },
    1222: { day: "Przelotny obfity śnieg", night: "Przelotny obfity śnieg" },
    1225: { day: "Obfity śnieg", night: "Obfity śnieg" },
    1255: { day: "Lekkie opady śniegu", night: "Lekkie opady śniegu" },
    1258: { day: "Umiarkowane/obfite opady śniegu", night: "Umiarkowane/obfite opady śniegu" },
    
    // Sleet
    1069: { day: "Przelotny deszcz ze śniegiem", night: "Przelotny deszcz ze śniegiem" },
    1204: { day: "Lekki deszcz ze śniegiem", night: "Lekki deszcz ze śniegiem" },
    1207: { day: "Umiarkowany/obfity deszcz ze śniegiem", night: "Umiarkowany/obfity deszcz ze śniegiem" },
    1249: { day: "Lekkie opady deszczu ze śniegiem", night: "Lekkie opady deszczu ze śniegiem" },
    1252: { day: "Umiarkowane/obfite opady deszczu ze śniegiem", night: "Umiarkowane/obfite opady deszczu ze śniegiem" },
    
    // Ice pellets
    1237: { day: "Grad", night: "Grad" },
    1261: { day: "Lekkie opady gradu", night: "Lekkie opady gradu" },
    1264: { day: "Umiarkowane/obfite opady gradu", night: "Umiarkowane/obfite opady gradu" },
    
    // Thunder
    1087: { day: "Możliwe burze", night: "Możliwe burze" },
    1273: { day: "Lekki deszcz z burzą", night: "Lekki deszcz z burzą" },
    1276: { day: "Umiarkowany/obfity deszcz z burzą", night: "Umiarkowany/obfity deszcz z burzą" },
    1279: { day: "Lekki śnieg z burzą", night: "Lekki śnieg z burzą" },
    1282: { day: "Umiarkowany/obfity śnieg z burzą", night: "Umiarkowany/obfity śnieg z burzą" }
};
		
		const SEVERITY_TRANSLATIONS = {
    'minor': 'niskie',
    'moderate': 'umiarkowane',
    'severe': 'silne',
    'extreme': 'ekstremalne',
    'major': 'poważne',
    'unknown': 'nieokreślone'
};

        const WARNING_TRANSLATIONS = {
                'es': {
        'tormentas de': { name: 'Burze', description: 'Intensywne burze', severity: 'orange' },
        'moderate': { name: 'Umiarkowane', description: 'Umiarkowane zagrożenie', severity: 'yellow' },
        'severe': { name: 'Silne', description: 'Silne zagrożenie', severity: 'orange' },
        'extreme': { name: 'Ekstremalne', description: 'Ekstremalne zagrożenie', severity: 'red' }
            },
            'no': { // Norweski
                'snøskredfare': { name: 'Zagrożenie lawinowe', description: 'Możliwość wystąpienia lawin śnieżnych', severity: 'red' },
                'varsel': { name: 'Ostrzeżenie', description: 'Ostrzeżenie meteorologiczne', severity: 'yellow' }
            },
            'fr': { // Francuski
                'tempête': { name: 'Burza', description: 'Silna burza z wyładowaniami', severity: 'orange' },
                'vent': { name: 'Silny wiatr', description: 'Niebezpieczne podmuchy wiatru', severity: 'yellow' }
            },
            'pt': { // Portugalski
                'tempestade': { name: 'Burza', description: 'Silna burza z wyładowaniami', severity: 'orange' },
                'vento': { name: 'Wiatr', description: 'Silne porywy wiatru', severity: 'yellow' }
            },
            'zh': { // Chiński (Pekin)
                'blue lightning warning': { name: 'Niebieskie ostrzeżenie przed piorunami', description: 'Ostrzeżenie przed burzami z wyładowaniami', severity: 'yellow' },
                'yellow hail warning': { name: 'Żółte ostrzeżenie przed gradem', description: 'Ostrzeżenie przed silnymi opadami gradu', severity: 'orange' }
            },
			'sk': { // Słowacki
        'burza': { name: 'Búrka', description: 'Silná búrka s bleskami a hrmením', severity: 'orange' },
        'búrka': { name: 'Búrka', description: 'Silná búrka s bleskami a hrmením', severity: 'orange' },
        'dážď': { name: 'Dážď', description: 'Silné dažďové zrážky', severity: 'yellow' },
        'vietor': { name: 'Vietor', description: 'Silný vietor s nárazmi', severity: 'yellow' },
        'sneh': { name: 'Sneh', description: 'Silné snehové zrážky', severity: 'yellow' },
        'mráz': { name: 'Mráz', description: 'Nízke teploty pod bodom mrazu', severity: 'orange' }
    },
        };

        const WEATHER_ICONS = {
            1000: { day: '113.svg', night: '113.svg' }, // Sunny/Clear
            1003: { day: '116.svg', night: '116.svg' }, // Partly cloudy
            1006: { day: '119.svg', night: '119.svg' }, // Cloudy
            1009: { day: '122.svg', night: '122.svg' }, // Overcast
            1030: { day: '143.svg', night: '143.svg' }, // Mist
            1063: { day: '176.svg', night: '176.svg' }, // Patchy rain possible
            1066: { day: '179.svg', night: '179.svg' }, // Patchy snow possible
            1069: { day: '182.svg', night: '182.svg' }, // Patchy sleet possible
            1072: { day: '185.svg', night: '185.svg' }, // Patchy freezing drizzle possible
            1087: { day: '200.svg', night: '200.svg' }, // Thundery outbreaks possible
            1114: { day: '227.svg', night: '227.svg' }, // Blowing snow
            1117: { day: '230.svg', night: '230.svg' }, // Blizzard
            1135: { day: '248.svg', night: '248.svg' }, // Fog
            1147: { day: '260.svg', night: '260.svg' }, // Freezing fog
            1150: { day: '263.svg', night: '263.svg' }, // Patchy light drizzle
            1153: { day: '266.svg', night: '266.svg' }, // Light drizzle
            1168: { day: '281.svg', night: '281.svg' }, // Freezing drizzle
            1171: { day: '284.svg', night: '284.svg' }, // Heavy freezing drizzle
            1180: { day: '293.svg', night: '293.svg' }, // Patchy light rain
            1183: { day: '296.svg', night: '296.svg' }, // Light rain
            1186: { day: '299.svg', night: '299.svg' }, // Moderate rain at times
            1189: { day: '302.svg', night: '302.svg' }, // Moderate rain
            1192: { day: '305.svg', night: '305.svg' }, // Heavy rain at times
            1195: { day: '308.svg', night: '308.svg' }, // Heavy rain
            1198: { day: '311.svg', night: '311.svg' }, // Light freezing rain
            1201: { day: '314.svg', night: '314.svg' }, // Moderate or heavy freezing rain
            1204: { day: '317.svg', night: '317.svg' }, // Light sleet
            1207: { day: '320.svg', night: '320.svg' }, // Moderate or heavy sleet
            1210: { day: '323.svg', night: '323.svg' }, // Patchy light snow
            1213: { day: '326.svg', night: '326.svg' }, // Light snow
            1216: { day: '329.svg', night: '329.svg' }, // Patchy moderate snow
            1219: { day: '332.svg', night: '332.svg' }, // Moderate snow
            1222: { day: '335.svg', night: '335.svg' }, // Patchy heavy snow
            1225: { day: '338.svg', night: '338.svg' }, // Heavy snow
            1237: { day: '350.svg', night: '350.svg' }, // Ice pellets
            1240: { day: '353.svg', night: '353.svg' }, // Light rain shower
            1243: { day: '356.svg', night: '356.svg' }, // Moderate or heavy rain shower
            1246: { day: '359.svg', night: '359.svg' }, // Torrential rain shower
            1249: { day: '362.svg', night: '362.svg' }, // Light sleet showers
            1252: { day: '365.svg', night: '365.svg' }, // Moderate or heavy sleet showers
            1255: { day: '368.svg', night: '368.svg' }, // Light snow showers
            1258: { day: '371.svg', night: '371.svg' }, // Moderate or heavy snow showers
            1261: { day: '374.svg', night: '374.svg' }, // Light showers of ice pellets
            1264: { day: '377.svg', night: '377.svg' }, // Moderate or heavy showers of ice pellets
            1273: { day: '386.svg', night: '386.svg' }, // Patchy light rain with thunder
            1276: { day: '389.svg', night: '389.svg' }, // Moderate or heavy rain with thunder
            1279: { day: '392.svg', night: '392.svg' }, // Patchy light snow with thunder
            1282: { day: '395.svg', night: '395.svg' }  // Moderate or heavy snow with thunder
        };

        const RUNNER_TIPS = {
            sunny: {
                title: "Idealna pogoda na trening!",
                text: (temp) => {
                    if (temp > 30) return "🏃‍♂️ <strong>Bieganie w upale:</strong> Wybierz poranne lub wieczorne godziny. Noś przewiewne, jasne ubrania i czapkę z daszkiem. Pamiętaj o kremie z filtrem UV i nawadnianiu co 15-20 minut.";
                    if (temp > 25) return "☀️ <strong>Letni trening:</strong> Biegaj w cieniu drzew lub wzdłuż zbiorników wodnych. Zabierz ze sobą wodę w pasie biegowym lub mały plecak.";
                    return "😎 <strong>Dobra pogoda:</strong> Możesz biegać w krótkich spodenkach i koszulce. Rozważ trasę z różnymi rodzajami nawierzchni dla urozmaicenia treningu.";
                }
            },
            cloudy: {
                title: "Dobry dzień na bieganie!",
                text: (temp) => {
                    if (temp < 5) return "🧤 <strong>Chłodne warunki:</strong> Załóż rękawiczki i czapkę. Rozgrzewka powinna być dłuższa - zacznij od marszu i truchtu. Oddychaj przez nos, aby ogrzać powietrze.";
                    return "⛅ <strong>Optymalne warunki:</strong> Chmury chronią przed przegrzaniem. Możesz spróbować dłuższego dystansu lub interwałów. Uważaj na podmuchy wiatru w otwartym terenie.";
                }
            },
            rainy: {
                title: "Bieganie w deszczu?",
                text: (temp, precip) => {
                    if (temp < 10) return "🌧️ <strong>Zimny deszcz:</strong> Załóż wodoodporną kurtkę i czapkę z daszkiem. Unikaj bawełny - wybierz odzież techniczną. Biegaj krótsze dystanse i zwracaj uwagę na śliskie powierzchnie.";
                    if (precip > 10) return "☔ <strong>Ulewa:</strong> Jeśli musisz biegać, wybierz trasę z możliwością szybkiego schronienia. Po treningu od razu przebierz się w suche ubranie.";
                    return "💦 <strong>Lekki deszcz:</strong> To świetna okazja do treningu w trudniejszych warunkach. Załóż czapkę z daszkiem i jasne ubrania. Uważaj na kałuże i mokre liście.";
                }
            },
            snowy: {
                title: "Bieg w śniegu",
                text: (temp) => {
                    if (temp < -5) return "❄️ <strong>Ekstremalny mróz:</strong> Załóż kilka warstw odzieży termicznej. Ogrzej dłonie i stopy przed wyjściem. Skróć dystans i biegaj w pętli blisko domu.";
                    return "⛄ <strong>Śnieżna trasa:</strong> Wybierz buty z agresywnym bieżnikiem. Biegaj wolniej i krótszymi krokami. Rozważ trasę w lesie, gdzie wiatr jest mniejszy.";
                }
            },
            cold: {
                title: "Zimowy trening",
                text: (temp) => {
                    if (temp < -10) return "🧊 <strong>Silny mróz:</strong> Zakryj wszystkie odsłonięte części ciała. Rozgrzewkę wykonaj w domu. Biegaj z partnerem i miej przy sobie telefon.";
                    return "🧣 <strong>Chłodno:</strong> Oddychaj przez szalik lub buff. Po treningu nie stój na zimnie - od razu wejdź do ciepłego pomieszczenia. Rozciąganie wykonaj w domu.";
                }
            },
            hot: {
                title: "Upał? Bieganie wymaga ostrożności",
                text: (temp) => {
                    if (temp > 35) return "🔥 <strong>Ekstremalny upał:</strong> Rozważ trening na bieżni lub w klimatyzowanym pomieszczeniu. Jeśli biegasz na zewnątrz, wybierz wczesny poranek i miej przy sobie wodę.";
                    return "☀️ <strong>Gorąco:</strong> Biegaj w cieniu, np. w lesie lub parku. Zmniejsz intensywność treningu o 10-15%. Po biegu schładzaj się stopniowo.";
                }
            },
            windy: {
                title: "Silny wiatr?",
                text: (windSpeed) => {
                    if (windSpeed > 30) return "💨 <strong>Wichura:</strong> Unikaj otwartych przestrzeni i biegaj w osłoniętych miejscach. Uważaj na spadające gałęzie. Rozważ trening siłowy w domu.";
                    return "🌬️ <strong>Wietrznie:</strong> Rozpocznij bieg pod wiatr, aby mieć go w plecy na finiszu. Załóż przylegające ubranie, aby zmniejszyć opór powietrza. Chroń oczy okularami.";
                }
            },
            foggy: {
                title: "Mgła ogranicza widoczność",
                text: "🌫️ <strong>Bieganie w mgle:</strong> Noś odblaski i jasne ubrania. Biegaj znanymi, bezpiecznymi trasami z dala od ruchu ulicznego. Uważaj na nierówności terenu i kałuże.",
            },
            storm: {
                title: "⛈️ Uwaga na burzę!",
                text: `Środki ostrożności dla biegaczy:
                
1. <strong>Bezpieczeństwo przede wszystkim</strong>
   - Unikaj biegania gdy zapowiadana jest burza
   - Jeśli burza zaskoczy Cię w trakcie biegu, szukaj schronienia w budynku

2. <strong>Gdy musisz biegać</strong>
   - Wybierz krótką, znaną trasę z możliwością szybkiego schronienia
   - Unikaj otwartych przestrzeni, wody i wysokich obiektów
   - Nie używaj słuchawek - musisz słyszeć nadchodzącą burzę

3. <strong>Przygotowanie</strong>
   - Sprawdź dokładną prognozę przed wyjściem
   - Zabierz wodoodporną odzież i nakrycie głowy
   - Poinformuj kogoś o swojej trasie i planowanym czasie powrotu

4. <strong>Po burzy</strong>
   - Uważaj na mokre i śliskie powierzchnie
   - Sprawdź czy nie ma zerwanych linii energetycznych
   - Jeśli byłeś narażony na ulewę, zmień szybko ubranie po powrocie`
            },
            default: {
                title: "Gotowy na trening?",
                text: "👟 <strong>Dzisiejsze wskazówki:</strong> Dostosuj strój do warunków. Rozgrzej się przez 5-10 minut przed właściwym biegiem. Pamiętaj o nawodnieniu i rozciąganiu po treningu."
            }
        };

        const THEMES = [
            { name: 'Auto', value: 'auto', emoji: '🌓' },
            { name: 'Jasny', value: 'light', emoji: '☀️' },
            { name: 'Ciemny', value: 'dark', emoji: '🌙' },
            { name: 'Matrix', value: 'matrix', emoji: '📟' },
            { name: 'Hubba Bubba', value: 'hubba-bubba', emoji: '🍬' },
            { name: 'Las', value: 'forest', emoji: '🌲' },
            { name: 'Kosmos', value: 'space', emoji: '🚀' },
            { name: 'Pustynia', value: 'desert', emoji: '🏜️' },
            { name: 'Deszczowy Dzień', value: 'rainy-day', emoji: '🌧️' },
            { name: 'Wiosna', value: 'spring', emoji: '🌸' },
            { name: 'Lato', value: 'summer', emoji: '🌞' },
            { name: 'Jesień', value: 'autumn', emoji: '🍁' },
            { name: 'Zima', value: 'winter', emoji: '⛄' },
            // Nowe motywy
            { name: 'Świąteczny', value: 'christmas', emoji: '🎄' },
            { name: 'Wielkanoc', value: 'easter', emoji: '🐰' },
            { name: 'Urodziny', value: 'birthday', emoji: '🎂' },
            { name: 'Disco', value: 'disco', emoji: '🎵' },
            { name: 'Ocean', value: 'ocean', emoji: '🌊' },
            { name: 'Zachód słońca', value: 'sunset', emoji: '🌅' },
            { name: 'Neon', value: 'neon', emoji: '💡' },
            { name: 'Retro', value: 'retro', emoji: '📺' },
            { name: 'Galaktyka', value: 'galaxy', emoji: '🌌' },
            { name: 'Słodki', value: 'candy', emoji: '🍭' },
            { name: 'Monochrom', value: 'monochrome', emoji: '⚫' },
            { name: 'Bursztyn', value: 'amber', emoji: '🟠' },
			{ name: 'LKS Burzyn ', value: 'dzik', emoji: '🐗' }
			
			
			
        ];

        let currentLat = null;
        let currentLon = null;
        let lastWeatherData = null;
        let themeMode = 'auto'; // auto, light, dark, matrix, hubba-bubba, forest, etc.

        function showLoading(show) {
            weatherElements.loadingIndicator.style.display = show ? 'flex' : 'none';
        }
		
		function translateWeatherCondition(code, isDay) {
    const translation = WEATHER_CODE_TRANSLATIONS[code] || 
                      { day: "Warunki pogodowe", night: "Warunki pogodowe" };
    return isDay ? translation.day : translation.night;
}
		


        function detectWarningLanguage(text) {
            if (!text) return 'en';
            
            // Proste wykrywanie języka na podstawie znaków
            if (/[а-яА-Я]/.test(text)) return 'ru';
            if (/[ěščřžýáíé]/.test(text)) return 'cs';
            if (/[ôáä]/.test(text)) return 'sk';
            if (/[äöüß]/.test(text)) return 'de';
            if (/[ñáéíóúü]/.test(text)) return 'es';
            if (/[ãõáéíóúâêô]/.test(text)) return 'pt';
            if (/[àâçéèêëîïôùûüÿ]/.test(text)) return 'fr';
            if (/[æøåÆØÅ]/.test(text)) return 'no';
            if (/[\u4e00-\u9fff]/.test(text)) return 'zh'; // Chiński
            
            return 'en';
			
        }

        async function translateWarning(text, sourceLang = 'en') 
		
		{
            if (!text || !/[a-zA-Zа-яА-Я]/.test(text)) return text;
			
            
            try {
                // Najpierw wykonaj podstawowe tłumaczenie
                const timestamp = new Date().getTime();
                const response = await fetch(
                    `${TRANSLATE_SCRIPT_URL}?text=${encodeURIComponent(text)}&source=${sourceLang}&target=pl&nocache=${timestamp}`
                );
                
                if (!response.ok) throw new Error('Błąd tłumaczenia: ' + response.status);
                
                let translated = await response.text();
				const severityTranslations = {
        'minor': 'niskie',
        'moderate': 'umiarkowane', 
        'severe': 'silne',
        'extreme': 'ekstremalne',
        'major': 'poważne',
        'unknown': 'nieokreślone'
    };

    // Tylko tłumaczymy stopnie, nie zmieniamy reszty tekstu
    for (const [eng, pl] of Object.entries(severityTranslations)) {
        text = text.replace(new RegExp(`\\b${eng}\\b`, 'gi'), pl);
    }
				
				
                
                // Specjalne przypadki dla chińskich ostrzeżeń (Pekin)
                if (sourceLang === 'zh') {
                    translated = translated
                        .replace(/Miyun District Meteorological Observatory issues blue lightning warning/g, 'Obserwatorium Meteorologiczne Dzielnicy Miyun wydaje niebieskie ostrzeżenie przed piorunami')
                        .replace(/Miyun District Meteorological Observatory issues yellow hail warning/g, 'Obserwatorium Meteorologiczne Dzielnicy Miyun wydaje żółte ostrzeżenie przed gradem')
                        .replace(/\[IV\/General\]/g, '[IV/Ogólne]')
                        .replace(/\[III\/Heavy\]/g, '[III/Ciężkie]');
                }
				
				// Specjalne przypadki dla słowackich ostrzeżeń
    if (sourceLang === 'sk') {
        translated = translated
            .replace(/Burza/g, 'Búrka')
            .replace(/giełda/g, 'búrka') // Poprawka dla błędnego tłumaczenia
            .replace(/Výstraha pred/g, 'Varovanie pred')
            .replace(/Národná výstražná služba/g, 'Národná výstražná služba');
    }

                // Specjalne przypadki dla hiszpańskich ostrzeżeń
                if (sourceLang === 'es') {
                    translated = translated
                        .replace(/Aviso de tormentas de nivel amarillo/g, 'Żółte ostrzeżenie przed burzami')
                        .replace(/Aviso de vientos de nivel amarillo/g, 'Żółte ostrzeżenie przed silnymi wiatrami')
                        .replace(/Aviso de costeros de nivel amarillo/g, 'Żółte ostrzeżenie przed wiatrami przybrzeżnymi')
                        .replace(/Valle del Tajo/g, 'Dolina Tagu')
                        .replace(/Litoral de Barcelona/g, 'Wybrzeże Barcelony')
                        .replace(/Costa - Litoral de Huelva/g, 'Wybrzeże Huelvy')
                        .replace(/tormentas de/g, 'burzami')
                        .replace(/vientos de/g, 'wiatrami');
                }
				

                // Poprawki ogólne
                translated = translated
                    .replace(/nivel amarillo/g, 'żółty poziom')
                    .replace(/Forest Defense Office/g, 'Biuro Ochrony Lasów')
                    .replace(/issues (.*?) warning/g, 'wydaje $1 ostrzeżenie')
                    .replace(/at (\d{2}:\d{2}) on (.*? \d{4})/g, 'od godziny $1 $2 r.')
                    .replace(/Avertissement de/g, 'Ostrzeżenie przed')
                    .replace(/en vigueur/g, 'obowiązujące')
                    .replace(/Vigilance/g, 'Monitorowanie')
                    .replace(/Alerta de/g, 'Ostrzeżenie przed')
                    .replace(/Aviso de/g, 'Ostrzeżenie przed')
                    .replace(/Varsel om/g, 'Ostrzeżenie o')
                    .replace(/snøskredfare/g, 'zagrożeniu lawinowym');
                
                return translated || text;
            } catch (error) {
                console.error('Błąd tłumaczenia:', error);
                return text;
            }
        }

        function extractWarningDetails(alert, lang = 'en') {
            const defaultType = WARNING_TYPES.storm;
            if (!alert.headline) return { type: defaultType, description: defaultType.description };
			
			
            
            const lowerHeadline = alert.headline.toLowerCase();
            
            // Specjalne przypadki dla chińskich ostrzeżeń (Pekin)
            if (lang === 'zh') {
                if (lowerHeadline.includes('blue lightning warning')) {
                    return {
                        type: { 
                            emoji: '⚡', 
                            name: 'Niebieskie ostrzeżenie przed piorunami', 
                            description: 'Ostrzeżenie przed burzami z wyładowaniami',
                            severity: 'yellow'
                        },
                        description: alert.headline
                    };
                }
                if (lowerHeadline.includes('yellow hail warning')) {
                    return {
                        type: { 
                            emoji: '🧊', 
                            name: 'Żółte ostrzeżenie przed gradem', 
                            description: 'Ostrzeżenie przed silnymi opadami gradu',
                            severity: 'orange'
                        },
                        description: alert.headline
                    };
                }
            }
            
            // Specjalne przypadki dla hiszpańskich ostrzeżeń
            if (lang === 'es') {
                if (lowerHeadline.includes('tormentas')) {
                    return {
                        type: { 
                            emoji: '⛈️', 
                            name: 'Burza', 
                            description: 'Burza z intensywnymi wyładowaniami atmosferycznymi',
                            severity: 'orange'
                        },
                        description: alert.headline
                    };
                }
                if (lowerHeadline.includes('vientos')) {
                    return {
                        type: { 
                            emoji: '💨', 
                            name: 'Silny wiatr', 
                            description: 'Niebezpieczne podmuchy wiatru',
                            severity: 'yellow'
                        },
                        description: alert.headline
                    };
                }
				
                if (lowerHeadline.includes('costeros')) {
                    return {
                        type: { 
                            emoji: '🌊', 
                            name: 'Wiatry przybrzeżne', 
                            description: 'Silne wiatry nadmorskie',
                            severity: 'yellow'
                        },
                        description: alert.headline
                    };
                }
            }
			
            
            // Specjalne przypadki dla norweskich ostrzeżeń
            if (lang === 'no') {
                if (lowerHeadline.includes('snøskredfare')) {
                    return {
                        type: { 
                            emoji: '🏔️', 
                            name: 'Zagrożenie lawinowe', 
                            description: 'Możliwość lawin w regionie',
                            severity: 'red'
                        },
                        description: alert.headline
                    };
                }
            }
			
			// Specjalne przypadki dla języka słowackiego
    if (lang === 'sk' && alert.headline) {
        if (alert.headline.includes('Burza') || alert.headline.includes('Búrka')) {
            return {
                type: { 
                    emoji: '⛈️', 
                    name: 'Búrka', 
                    description: 'Silná búrka s bleskami a hrmením',
                    severity: 'orange'
                },
                description: alert.description || alert.headline
            };
        }
    }


            for (const [key, value] of Object.entries(WARNING_TYPES)) {
                if (lowerHeadline.includes(key)) {
                    if (lang !== 'pl' && WARNING_TRANSLATIONS[lang]?.[key]) {
                        return {
                            type: {
                                emoji: value.emoji,
                                name: WARNING_TRANSLATIONS[lang][key].name,
                                description: WARNING_TRANSLATIONS[lang][key].description,
                                severity: WARNING_TRANSLATIONS[lang][key].severity || value.severity
                            },
                            description: alert.headline || WARNING_TRANSLATIONS[lang][key].description
                        };
                    }
                    return {
                        type: value,
                        description: alert.headline || value.description
                    };
                }
            }

            return { type: defaultType, description: alert.headline || defaultType.description };
        }

async function renderWarning(alert) {

    // Specjalna obsługa ostrzeżeń hydrologicznych
    if (alert.type === 'hydro') {
        return `
            <div class="warning-card ${alert.severity}">
                <div class="warning-header">
                    <span class="warning-icon">${alert.emoji}</span>
                    <span class="warning-title">${alert.headline} (IMGW Hydro via TVP)</span>
                </div>
                <div class="warning-details">
                    ${alert.description.replace(/\n/g, '<br>')}
                    ${alert.link ? `<br><a href="${alert.link}" target="_blank" style="color: var(--primary);">Czytaj więcej na tvp.pl</a>` : ''}
                </div>
                <div class="warning-time">
                    <strong>Opublikowano:</strong> ${new Date(alert.effective).toLocaleString('pl-PL')}
                </div>
                <div class="warning-footer" style="font-size:0.7em; margin-top:0.5rem; opacity:0.7;">
                    Ostrzeżenie hydrologiczne - sprawdź lokalne komunikaty dla szczegółów.
                </div>
            </div>
        `;
    }
	
    const lang = detectWarningLanguage(alert.headline || alert.description);
    const details = extractWarningDetails(alert, lang);
    const severity = details.type.severity || 'yellow';
	
	
	
    
    // Tłumaczymy tylko jeśli to konieczne
    const descriptionToTranslate = alert.description || alert.headline || '';
    let translatedContent = descriptionToTranslate;
    
    if (lang !== 'pl') {
        translatedContent = await translateWarning(descriptionToTranslate, lang);
    }
	
	

    // Format dat
    const effectiveDate = alert.effective ? new Date(alert.effective).toLocaleString('pl-PL') : 'Nieznany';
    const expiresDate = alert.expires ? new Date(alert.expires).toLocaleString('pl-PL') : 'Nieznany';

    // Sprawdzanie duplikatów
    const existingWarnings = document.querySelectorAll('.warning-details');
    for (const warning of existingWarnings) {
        if (warning.textContent.includes(translatedContent.substring(0, 50))) {
            return '';
        }
    }
	
	

    // Formatowanie szczegółowych ostrzeżeń
    let warningDetails = '';
    if (translatedContent.includes('stopień:') || translatedContent.includes('prawd.')) {
        warningDetails = `
            <div class="warning-details">
                ${translatedContent.replace(/\n/g, '<br>')}
            </div>
        `;
    } else {
        warningDetails = `
            <div class="warning-details">
                ${translatedContent}
                ${alert.note ? `<div class="warning-note">${alert.note}</div>` : ''}
            </div>
        `;
    }
	
	
	

return `
        <div class="warning-card ${severity}">
            <div class="warning-header">
                <span class="warning-icon">${details.type.emoji}</span>
                <div>
                    <div class="warning-title">${details.type.name}</div>
                    ${alert.severity ? `
                        <div class="warning-severity">
                            Stopień: ${await translateWarning(alert.severity.toLowerCase())}
                        </div>
                    ` : ''}
                </div>
            </div>
            <div class="warning-details">
                ${translatedContent.replace(/\n/g, '<br>')}
            </div>
            <div class="warning-time">
                <strong>⏰ Czas obowiązywania:</strong><br>
                <span>⌛ Od: ${effectiveDate}</span><br>
                <span>🛑 Do: ${expiresDate}</span>
                </div>
				<div class="warning-footer" style="font-size:0.7em; margin-top:0.5rem; opacity:0.7;">
                        Ostrzeżenia są opracowywane na podstawie prognoz regionalnych centrów meteorologicznych i dotyczą obszarów, na których może wystąpić dane zjawisko.
                    </div>
            </div>
        </div>
    `;
}



			


        function hasStormForecast(forecastData) {
            if (!forecastData || !forecastData.forecastday) return false;
            
            // Sprawdzamy prognozę godzinową na najbliższe 12 godzin
            const next12Hours = forecastData.forecastday[0]?.hour?.filter(hour => {
                const hourTime = new Date(hour.time);
                const now = new Date();
                return hourTime > now && hourTime < new Date(now.getTime() + 12 * 60 * 60 * 1000);
            });
            
            if (!next12Hours) return false;
            
            // Szukamy burzy w opisie lub kodzie warunków
            return next12Hours.some(hour => {
                const condition = hour.condition?.text?.toLowerCase() || '';
                return condition.includes('burza') || 
                       condition.includes('storm') || 
                       condition.includes('thunder') ||
                       [1087, 1273, 1276, 1279, 1282].includes(hour.condition?.code);
            });
        }
		
		// Funkcja do aktualizacji ostrzeżenia o przymrozkach
// Zaktualizowana funkcja do aktualizacji widgetu przymrozków
// Zaktualizowana funkcja do aktualizacji widgetu przymrozków
function updateFrostWidget(hourlyForecast, alerts) {
    const container = document.getElementById('frostContent');
    if (!container) return;

    const frostWarnings = checkForFrostWarnings(alerts);
    const forecastFrostPeriods = getFrostPeriodsFromForecast(hourlyForecast);
    container.innerHTML = generateFrostWidgetContent(frostWarnings, forecastFrostPeriods);
}

function checkForFrostWarnings(alerts) {
    if (!alerts || !alerts.alert) return [];
    
    const now = new Date();
    const frostKeywords = [
        'przymrozk', 'mróz', 'niską temperaturą', 
        'frost', 'freez', 'low temperature', 'zimno'
    ];
    
    return alerts.alert.filter(alert => {
        const isFrostAlert = frostKeywords.some(keyword => 
            (alert.headline && alert.headline.toLowerCase().includes(keyword)) ||
            (alert.event && alert.event.toLowerCase().includes(keyword))
        );
        
        if (!isFrostAlert) return false;
        
        const start = alert.effective ? new Date(alert.effective) : null;
        const end = alert.expires ? new Date(alert.expires) : null;
        
        alert.isActive = start && end && now >= start && now <= end;
        alert.isFuture = start && now < start;
        
        return true;
    });
}

function getTimeOfDay(date) {
    const hours = date.getHours();
    if (hours >= 5 && hours < 10) return 'rano';
    if (hours >= 10 && hours < 12) return 'przedpołudniem';
    if (hours >= 12 && hours < 18) return 'południem';
    if (hours >= 18 && hours < 23) return 'wieczorem';
    return 'w nocy';
}

function getSeverityLevel(temp) {
    if (temp > 0 && temp <= 2) {
        return { level: 'niski', description: 'możliwość wystąpienia lokalnych przymrozków', color: '#3498db' };
    } else if (temp <= 0 && temp > -2) {
        return { level: 'umiarkowany', description: 'słabe i lekkie przymrozki', color: '#f39c12' };
    } else if (temp <= -2 && temp > -4) {
        return { level: 'silny', description: 'silne przymrozki', color: '#e74c3c' };
    } else if (temp <= -4) {
        return { level: 'ekstremalny', description: 'ekstremalne przymrozki (mróz)', color: '#9b59b6' };
    }
    return { level: 'brak', description: 'brak przymrozków', color: '#2ecc71' };
}

function getFrostPeriodsFromForecast(hourlyForecast) {
    if (!hourlyForecast || !hourlyForecast.length) return [];
    
    const now = new Date();
    const frostPeriods = [];
    let currentPeriod = null;
    
    hourlyForecast.forEach(hour => {
        const hourTime = new Date(hour.time);
        if (hourTime < now) return;
        
        const isFrostHour = hour.temp_c <= 2;
        
        if (isFrostHour) {
            if (!currentPeriod) {
                currentPeriod = {
                    start: hourTime,
                    end: hourTime,
                    minTemp: hour.temp_c,
                    conditions: hour.condition?.text || '',
                    severity: getSeverityLevel(hour.temp_c)
                };
            } else {
                currentPeriod.end = hourTime;
                currentPeriod.minTemp = Math.min(currentPeriod.minTemp, hour.temp_c);
                currentPeriod.severity = getSeverityLevel(currentPeriod.minTemp);
            }
        } else if (currentPeriod) {
            frostPeriods.push(currentPeriod);
            currentPeriod = null;
        }
    });
    
    if (currentPeriod) frostPeriods.push(currentPeriod);
    return frostPeriods;
}

function generateFrostWidgetContent(warnings, forecastPeriods) {
    const now = new Date();
    const activeWarnings = warnings.filter(w => w.isActive);
    const futureWarnings = warnings.filter(w => w.isFuture);
    
    if (activeWarnings.length > 0 || forecastPeriods.length > 0) {
        let html = '<div class="frost-header" style="color:#d35400; font-weight:bold; margin-bottom:0.5rem;">❄️ AKTYWNE OSTRZEŻENIE O PRZYMROZKACH</div>';
        
        activeWarnings.forEach(warning => {
            html += `
                <div class="frost-alert" style="background-color:var(--alert-bg); padding:0.5rem; border-radius:0.25rem; margin-bottom:0.5rem;">
                    <div style="font-weight:bold;">${warning.headline || 'Ostrzeżenie IMGW'}</div>
                    <div style="font-size:0.9rem; margin-top:0.3rem;">
                        <strong>Okres obowiązywania:</strong><br>
                        ${formatAlertPeriod(warning.effective, warning.expires)}
                    </div>
                    ${warning.description ? `
                    <div style="font-size:0.85rem; margin-top:0.3rem;">
                        ${warning.description}
                    </div>` : ''}
                </div>
            `;
        });
        
        if (forecastPeriods.length > 0) {
            html += '<div class="frost-forecast" style="margin-top:0.5rem;">';
            html += '<div style="font-weight:bold;">Prognozowane okresy przymrozków:</div>';
            
            const groupedPeriods = {};
            forecastPeriods.forEach(period => {
                const dateStr = period.start.toLocaleDateString('pl-PL');
                const timeOfDay = getTimeOfDay(period.start);
                const key = `${dateStr} ${timeOfDay}`;
                
                if (!groupedPeriods[key]) {
                    groupedPeriods[key] = {
                        date: period.start,
                        timeOfDay: timeOfDay,
                        minTemp: period.minTemp,
                        conditions: period.conditions,
                        severity: period.severity
                    };
                } else {
                    groupedPeriods[key].minTemp = Math.min(groupedPeriods[key].minTemp, period.minTemp);
                    groupedPeriods[key].severity = getSeverityLevel(groupedPeriods[key].minTemp);
                }
            });
            
            Object.values(groupedPeriods).forEach(period => {
                const dateStr = period.date.toLocaleDateString('pl-PL');
                html += `
                    <div style="margin-top:0.5rem; padding:0.5rem; border-radius:0.25rem; 
                         background-color:${period.severity.color}20; border-left:3px solid ${period.severity.color};">
                        <strong>${dateStr} ${period.timeOfDay}</strong><br>
                        Minimalna temperatura: <strong>${period.minTemp.toFixed(1)}°C</strong><br>
                        Stopień zagrożenia: <strong style="color:${period.severity.color}">${period.severity.level}</strong><br>
                        <small>${period.severity.description}</small><br>
                        Warunki: ${period.conditions}
                    </div>
                `;
            });
            
            html += '</div>';
        }
        
        html += `
            <div class="frost-advice" style="margin-top:1rem; padding:0.5rem; 
                 background-color:var(--advice-bg); border-radius:0.25rem; color:var(--text-color);">
                <div style="font-weight:bold;">Zalecenia:</div>
                <ul style="margin-top:0.3rem; padding-left:1rem; font-size:0.9rem;">
                    <li>Osłoń rośliny wrażliwe na mróz, agrowłókniną lub słomą</li>
                    <li>Zabezpiecz zwierzęta hodowlane</li>
                    <li>Zabezpiecz instalacje wodne przed zamarznięciem</li>
                    <li>Rano załóż ciepłe ubranie</li>
                    <li>Uważaj na śliskie powierzchnie</li>
                </ul>
            </div>
        `;
        
        return html;
    }
    else if (futureWarnings.length > 0) {
        let html = '<div class="frost-header" style="color:#e67e22; font-weight:bold; margin-bottom:0.5rem;">❄️ PLANOWANE OSTRZEŻENIA</div>';
        
        futureWarnings.forEach(warning => {
            html += `
                <div style="margin-bottom:0.5rem;">
                    <div style="font-weight:bold;">${warning.headline || 'Ostrzeżenie IMGW'}</div>
                    <div style="font-size:0.9rem; margin-top:0.3rem;">
                        <strong>Planowany okres:</strong><br>
                        ${formatAlertPeriod(warning.effective, warning.expires)}
                    </div>
                </div>
            `;
        });
        
        return html;
    }
    else {
        return '<div style="text-align:center; padding:0.5rem; color:var(--text-secondary);">Brak aktywnych ostrzeżeń o przymrozkach</div>';
    }
}

function formatAlertPeriod(startStr, endStr) {
    try {
        const start = startStr ? new Date(startStr) : null;
        const end = endStr ? new Date(endStr) : null;
        
        if (!start || !end) return 'Brak danych czasowych';
        
        return `Od: ${start.toLocaleString('pl-PL')}<br>Do: ${end.toLocaleString('pl-PL')}`;
    } catch (e) {
        return 'Błędny format daty';
    }
}

// Funkcja do rysowania wykresu temperatury
let temperatureChart = null;

function renderTemperatureChart(hourlyForecast) {
    const ctx = document.getElementById('temperatureChart').getContext('2d');
    const now = new Date();
    const next24Hours = hourlyForecast
        .filter(hour => new Date(hour.time) >= now)
        .slice(0, 24);
    
    const labels = next24Hours.map(hour => 
        new Date(hour.time).toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit', hour12: false})
    );
    const temps = next24Hours.map(hour => hour.temp_c);
    
    if (temperatureChart) temperatureChart.destroy();
    
    temperatureChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Temperatura (°C)',
                data: temps,
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { title: { display: true, text: '°C' } },
                x: { grid: { display: false } }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.parsed.y}°C`;
                        }
                    }
                }
            }
        }
    });
}
		
		
		
		// Obsługa przewijania widgetów
function handleWidgetScroll() {
    const widgetsContainer = document.querySelector('.widgets-container');
    const container = document.querySelector('.container');
    
    if (!widgetsContainer || !container) return;

    const containerRect = container.getBoundingClientRect();
    const scrollPosition = window.scrollY;
    const containerTop = containerRect.top + scrollPosition;
    const containerBottom = containerTop + containerRect.height;

    if (scrollPosition < containerTop) {
        // Przed kontenerem - widgety na górze
        widgetsContainer.style.position = 'absolute';
        widgetsContainer.style.top = '20px';
        widgetsContainer.style.bottom = 'auto';
    } else if (scrollPosition + window.innerHeight > containerBottom) {
        // Po kontenerze - widgety na dole
        widgetsContainer.style.position = 'absolute';
        widgetsContainer.style.top = 'auto';
        widgetsContainer.style.bottom = '20px';
    } else {
        // W trakcie przewijania kontenera - widgety przyklejone
        widgetsContainer.style.position = 'fixed';
        widgetsContainer.style.top = '20px';
        widgetsContainer.style.bottom = 'auto';
    }
}

		
		function toggleWidgets() {
    const container = document.querySelector('.widgets-container');
    container.classList.toggle('visible');
}

        function getRunnerTip(weatherCondition, temp, precip = 0, forecastData) {
            // Najpierw sprawdzamy czy jest prognozowana burza
            if (hasStormForecast(forecastData)) {
                return RUNNER_TIPS.storm;
            }
            
            // Reszta logiki wyboru porady
            const condition = weatherCondition.toLowerCase();
            
            if (temp > 25) {
                return {
                    title: RUNNER_TIPS.hot.title,
                    text: RUNNER_TIPS.hot.text(temp)
                };
            } else if (temp < 5) {
                return {
                    title: RUNNER_TIPS.cold.title,
                    text: RUNNER_TIPS.cold.text(temp)
                };
            } else if (condition.includes('deszcz') || condition.includes('rain')) {
                return {
                    title: RUNNER_TIPS.rainy.title,
                    text: RUNNER_TIPS.rainy.text(temp, precip)
                };
            } else if (condition.includes('śnieg') || condition.includes('snow')) {
                return {
                    title: RUNNER_TIPS.snowy.title,
                    text: RUNNER_TIPS.snowy.text(temp)
                };
            } else if (condition.includes('słonecznie') || condition.includes('sunny')) {
                return {
                    title: RUNNER_TIPS.sunny.title,
                    text: RUNNER_TIPS.sunny.text(temp)
                };
            } else if (condition.includes('pochmurno') || condition.includes('cloudy')) {
                return {
                    title: RUNNER_TIPS.cloudy.title,
                    text: RUNNER_TIPS.cloudy.text(temp)
                };
            } else if (condition.includes('wiatr') || condition.includes('wind')) {
                return {
                    title: RUNNER_TIPS.windy.title,
                    text: RUNNER_TIPS.windy.text(forecastData?.current?.wind_kph || 0)
                };
            } else if (condition.includes('mgła') || condition.includes('fog')) {
                return {
                    title: RUNNER_TIPS.foggy.title,
                    text: RUNNER_TIPS.foggy.text
                };
            }
            
            return RUNNER_TIPS.default;
        }

async function updateWarnings(alerts) {
    const container = weatherElements.weatherWarnings;
    
    // Pobierz ostrzeżenia z TVP
    let tvpWarnings = [];
    try {
        tvpWarnings = await fetchTvpWarnings();
    } catch (error) {
        console.error('Błąd TVP:', error);
    }

    // Połącz wszystkie ostrzeżenia
    const allWarnings = [
        ...(alerts?.alert || []),
        ...tvpWarnings
    ];

    
    if (allWarnings.length === 0) {
        container.innerHTML = `
            <div class="warning-card">
                <div class="warning-header">
                    <span class="warning-icon">✅</span>
                    <span class="warning-title">Brak aktywnych ostrzeżeń</span>
                </div>
                <div class="warning-details">
                    Obecnie nie ma żadnych aktywnych ostrzeżeń pogodowych dla Twojej lokalizacji.
                </div>
            </div>
        `;
        return;
    }

    showLoading(true);
    container.innerHTML = `
        <div class="warning-card">
            <div class="warning-header">
                <span class="warning-icon">🔄</span>
                <span class="warning-title">Ładowanie ostrzeżeń...</span>
            </div>
        </div>
    `;

    try {
        const warningsHTML = await Promise.all(
            allWarnings.map(alert => renderWarning(alert))
        );
        
        // Filtruj puste wyniki i duplikaty
       const uniqueWarningsHTML = warningsHTML.filter(html => html !== '');
        
        if (uniqueWarningsHTML.length === 0) {
            container.innerHTML = `
                <div class="warning-card">
                    <div class="warning-header">
                        <span class="warning-icon">ℹ️</span>
                        <span class="warning-title">Brak nowych ostrzeżeń</span>
                    </div>
                    <div class="warning-details">
                        Nie znaleziono nowych ostrzeżeń pogodowych.
                    </div>
                </div>
            `;
        } else {
            container.innerHTML = uniqueWarningsHTML.join('');
            
            // Dodaj informację o źródłach ostrzeżeń
            const sourcesInfo = document.createElement('div');
            sourcesInfo.className = 'warning-sources';
            sourcesInfo.textContent = 'Źródła ostrzeżeń: IMGW, Severe-Weather, MeteoAlarm, NWS';
            container.appendChild(sourcesInfo);
        }
    } catch (error) {
        console.error('Błąd przetwarzania ostrzeżeń:', error);
        container.innerHTML = `
            <div class="warning-card red">
                <div class="warning-header">
                    <span class="warning-icon">❌</span>
                    <span class="warning-title">Błąd ładowania ostrzeżeń</span>
                </div>
                <div class="warning-details">
                    Wystąpił problem podczas ładowania ostrzeżeń pogodowych.<br>
                    ${error.message || 'Spróbuj odświeżyć stronę.'}
                </div>
                <div class="warning-time">
                    <strong>Status:</strong> ${new Date().toLocaleString('pl-PL')}
                </div>
            </div>
        `;
    } finally {
        showLoading(false);
    }
}

        async function getWeatherIcon(code, isDay) {
            const iconData = WEATHER_ICONS[code] || WEATHER_ICONS[1000];
            const iconFile = isDay ? iconData.day : iconData.night;
            const iconPath = `weather-icons/${isDay ? 'day' : 'night'}/${iconFile}`;
            
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    img.width = 64;
                    img.height = 64;
                    img.alt = 'Weather icon';
                    resolve(img);
                };
                img.onerror = () => {
                    console.error('Błąd ładowania ikony:', iconPath);
                    resolve(createFallbackIcon());
                };
                img.src = iconPath;
            });
        }

        function createFallbackIcon() {
            const fallbackSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            fallbackSvg.setAttribute('viewBox', '0 0 64 64');
            fallbackSvg.setAttribute('width', '64');
            fallbackSvg.setAttribute('height', '64');
            fallbackSvg.innerHTML = `
                <circle cx="32" cy="32" r="30" fill="none" stroke="currentColor" stroke-width="2"/>
                <text x="32" y="32" text-anchor="middle" dominant-baseline="middle" fill="currentColor">?</text>
            `;
            return fallbackSvg;
        }

        function getAirQualityAdvice(aqi) {
            const advice = {
                1: { label: 'Dobra 😊', text: 'Możesz bezpiecznie uprawiać sport na powietrzu 🏃♂️🚴♀️', emoji: '🏆🌳' },
                2: { label: 'Umiarkowana 😐', text: 'Możliwa normalna aktywność z zachowaniem ostrożności 🚶♂️⚠️', emoji: '⚠️' },
                3: { label: 'Niezdrowa dla wrażliwych 😷', text: 'Ogranicz aktywność na zewnątrz jeśli jesteś w grupie ryzyka 🚷⛔', emoji: '😷' },
                4: { label: 'Niezdrowa 😨', text: 'Unikaj długotrwałego przebywania na zewnątrz 🏠❌', emoji: '😨' },
                5: { label: 'Bardzo niezdrowa ☠️', text: 'Zalecane pozostanie w domu z oczyszczaczem powietrza 🏠🔒', emoji: '☠️' },
                6: { label: 'Niebezpieczna 💀', text: 'Całkowicie unikaj aktywności na zewnątrz 🚫❗', emoji: '💀' }
            };
            return advice[aqi] || { label: '-', text: 'Brak danych', emoji: '❓' };
        }

        function formatTime(time) {
            if (!time) return '-';
            const [hours, minutes] = time.split(':');
            return `${hours.padStart(2, '0')}:${minutes}`;
        }

        function generateWeatherSummary(forecast) {
            if (!forecast || !forecast.forecastday || forecast.forecastday.length === 0) {
                return "Brak danych pogodowych do wygenerowania podsumowania.";
            }

            const today = forecast.forecastday[0];
             const weatherCode = forecast.forecastday[0].day.condition.code;
    const dayCondition = translateWeatherCondition(weatherCode, true);
            const maxTemp = today.day.maxtemp_c;
            const minTemp = today.day.mintemp_c;
            const avgHumidity = today.day.avghumidity;
            const maxWind = today.day.maxwind_kph;
            const totalPrecip = today.day.totalprecip_mm;
            const sunrise = parseSunTime(today.astro.sunrise);
            const sunset = parseSunTime(today.astro.sunset);

            // Calculate night temperature (22:00-06:00)
            let nightTemps = [];
            let dayTemps = [];
            let dayPrecipitation = false;
            
            if (today.hour) {
                today.hour.forEach(hour => {
                    const hourTime = new Date(hour.time).getHours();
                    if (hourTime >= 22 || hourTime <= 6) {
                        nightTemps.push(hour.temp_c);
                    }
                    if (hourTime >= 6 && hourTime <= 20) {
                        dayTemps.push(hour.temp_c);
                        if (hour.chance_of_rain > 30 || hour.chance_of_snow > 30) {
                            dayPrecipitation = true;
                        }
                    }
                });
            }

            const nightMinTemp = nightTemps.length > 0 ? Math.min(...nightTemps) : minTemp;
            const dayMaxTemp = dayTemps.length > 0 ? Math.max(...dayTemps) : maxTemp;

            let summary = '';
            
            // Day forecast
            if (dayPrecipitation) {
                summary += `W dzień przelotne opady deszczu . `;
            } else {
                summary += `W dzień  ${dayCondition.toLowerCase()}. `;
            }
            
            summary += `Temperatura wyniesie do ${dayMaxTemp.toFixed(1)}°C. `;

            // Wind description
            if (maxWind > 20) {
                summary += `Wiatr silny, z porywami do ${maxWind} km/h. `;
            } else if (maxWind > 10) {
                summary += `Wiatr umiarkowany, ${maxWind} km/h. `;
            } else {
                summary += `Wiatr słaby. `;
            }

            // Humidity description
            if (avgHumidity > 70) {
                summary += `Wilgotność względna wysoka – około ${avgHumidity}%. `;
            } else if (avgHumidity < 40) {
                summary += `Wilgotność względna niska – około ${avgHumidity}%. `;
            } else {
                summary += `Wilgotność względna na poziomie ${avgHumidity}%. `;
            }

            // Precipitation description
            if (totalPrecip > 5) {
                summary += `Spodziewane są intensywne opady deszczu (do ${totalPrecip} mm). `;
            } else if (totalPrecip > 0) {
                summary += `Możliwe niewielkie opady deszczu (do ${totalPrecip} mm). `;
            }

            // Night forecast
            summary += `W nocy temperatura spadnie do około ${nightMinTemp.toFixed(1)}°C.`;

            // Sunrise/sunset
            summary += ` Wschód słońca o ${sunrise}, zachód o ${sunset}.`;

            return summary;
        }

        async function updateHourlyForecast(hourlyData, isDay) {
            const hourlyContainer = weatherElements.hourlyForecast;
            if (!hourlyData || !Array.isArray(hourlyData)) {
                hourlyContainer.innerHTML = '<div class="hour-item">Brak danych godzinowych</div>';
                return;
            }
            
            const now = new Date();
            const nextHours = hourlyData
                .filter(hour => new Date(hour.time) >= now)
                .slice(0, 14);

            hourlyContainer.innerHTML = '';
            
            for (const hour of nextHours) {
                try {
                    const time = formatTime(hour.time.split(' ')[1]);
                    const temp = hour.temp_c?.toFixed(1) || '-';
                 const weatherCode = hour.condition?.code || 1000;
                    const iconCode = hour.condition?.code || 1000;
                    const hourIsDay = hour.is_day !== 0;
					const condition = translateWeatherCondition(weatherCode, hourIsDay);
                    
                    const iconImg = await getWeatherIcon(iconCode, hourIsDay);
                    
                    const hourElement = document.createElement('div');
                    hourElement.className = 'hour-item';
                    hourElement.innerHTML = `
                        <div>${time}</div>
                        <div class="weather-icon"></div>
                        <div>${temp}°C</div>
                        <div style="font-size: 0.9rem;">${condition}</div>
                    `;
                    
                    hourElement.querySelector('.weather-icon').appendChild(iconImg);
                    hourlyContainer.appendChild(hourElement);
                 } catch (e) {
            console.error('Błąd tworzenia prognozy godzinowej:', e);
        }
    }
}

        async function updateDailyForecast(forecastDays) {
    const forecastContainer = weatherElements.forecast;
    if (!forecastDays || !Array.isArray(forecastDays)) {
        forecastContainer.innerHTML = '<div class="card">Brak danych długoterminowych</div>';
        return;
    }
    
    forecastContainer.innerHTML = '';
    
    // Pobierz aktualną datę
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Przygotuj etykiety dni
    const dayLabels = ['Dziś', 'Jutro', 'Pojutrze', 'Za 3 dni', 'Za 4 dni'];
    
    // Pokaż prognozę na 5 dni (dziś + 4 kolejne dni)
    for (let i = 0; i < Math.min(5, forecastDays.length); i++) {
        try {
            const day = forecastDays[i];
            const date = new Date(day.date);
            const dayLabel = dayLabels[i] || date.toLocaleDateString('pl', { weekday: 'long' });
            const weatherCode = day.day?.condition?.code || 1000;
            const condition = translateWeatherCondition(weatherCode, true);
            const maxTemp = day.day?.maxtemp_c?.toFixed(1) || '-';
            const minTemp = day.day?.mintemp_c?.toFixed(1) || '-';
            const iconCode = day.day?.condition?.code || 1000;
            const chanceOfRain = day.day?.daily_chance_of_rain || 0;
            const chanceOfSnow = day.day?.daily_chance_of_snow || 0;
            
            const iconImg = await getWeatherIcon(iconCode, true);
            
            const dayElement = document.createElement('div');
            dayElement.className = 'card';
            dayElement.innerHTML = `
                <div style="font-weight: 600;">${dayLabel}</div>
                <div style="font-size: 0.8rem; opacity: 0.8;">${formatPolishDate(date)}</div>
                <div class="weather-icon"></div>
                <div style="margin: 0.5rem 0; font-size: 0.9rem;">${condition}</div>
                <div class="temp-extremes">
                    <span class="temp-max">↑ ${maxTemp}°C</span>
                    <span class="temp-min">↓ ${minTemp}°C</span>
                </div>
                ${chanceOfRain > 0 ? `<div style="font-size:0.8rem;">☔ ${chanceOfRain}%</div>` : ''}
                ${chanceOfSnow > 0 ? `<div style="font-size:0.8rem;">❄️ ${chanceOfSnow}%</div>` : ''}
            `;
            
            dayElement.querySelector('.weather-icon').appendChild(iconImg);
            forecastContainer.appendChild(dayElement);
        } catch (e) {
            console.error('Błąd tworzenia prognozy dziennej:', e);
        }
    }
}

// Funkcja pomocnicza do formatowania daty w stylu "15 stycznia"
function formatPolishDate(date) {
    const months = [
        'stycznia', 'lutego', 'marca', 'kwietnia', 
        'maja', 'czerwca', 'lipca', 'sierpnia',
        'września', 'października', 'listopada', 'grudnia'
    ];
    return `${date.getDate()} ${months[date.getMonth()]}`;
}

        async function updateCurrentWeatherIcon(code, isDay) {
            const iconContainer = weatherElements.currentIcon;
            iconContainer.innerHTML = '';
            
            const iconImg = await getWeatherIcon(code, isDay);
            iconContainer.appendChild(iconImg);
        }

   function createThemeSelector() {
    // Przycisk przełącznika
    const toggleBtn = document.createElement('div');
    toggleBtn.className = 'theme-toggle';
    toggleBtn.innerHTML = '🎨 Motyw';
    toggleBtn.addEventListener('click', toggleThemePanel);
    
    // Panel z opcjami
    const panel = document.createElement('div');
    panel.className = 'theme-panel hidden';
    panel.innerHTML = `
        <div class="theme-options">
            ${THEMES.map(theme => 
                `<div class="theme-option" data-value="${theme.value}">
                    ${theme.emoji} ${theme.name}
                </div>`
            ).join('')}
        </div>
    `;
    
    document.body.appendChild(toggleBtn);
    document.body.appendChild(panel);
    
    // Obsługa kliknięć w opcje
    panel.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', () => {
            setTheme(option.dataset.value);
            panel.classList.add('hidden');
        });
    });
}

function toggleThemePanel() {
    const panel = document.querySelector('.theme-panel');
    panel.classList.toggle('hidden');
}

        function setTheme(theme) {
            themeMode = theme;
            document.body.className = '';
            
            const themeClasses = {
                'light': 'light-mode',
                'dark': 'dark-mode',
                'matrix': 'matrix-mode',
                'hubba-bubba': 'hubba-bubba-mode',
                'forest': 'forest-mode',
                'space': 'space-mode',
                'desert': 'desert-mode',
                'rainy-day': 'rainy-day-mode',
                'spring': 'spring-mode',
                'summer': 'summer-mode',
                'autumn': 'autumn-mode',
                'winter': 'winter-mode',
                'christmas': 'christmas-mode',
                'easter': 'easter-mode',
                'birthday': 'birthday-mode',
                'disco': 'disco-mode',
                'ocean': 'ocean-mode',
                'sunset': 'sunset-mode',
                'neon': 'neon-mode',
                'retro': 'retro-mode',
                'galaxy': 'galaxy-mode',
                'candy': 'candy-mode',
                'monochrome': 'monochrome-mode',
                'amber': 'amber-mode',
				'dzik': 'dzik-mode'
            };
            
            if (theme !== 'auto' && themeClasses[theme]) {
                document.body.classList.add(themeClasses[theme]);
            } else {
                // Auto mode - sprawdź porę dnia dla aktualnej lokalizacji
                if (lastWeatherData) {
                    const sunrise = parseSunTime(lastWeatherData.forecast.forecastday[0].astro.sunrise);
                    const sunset = parseSunTime(lastWeatherData.forecast.forecastday[0].astro.sunset);
                    setThemeBasedOnTime(sunrise, sunset, lastWeatherData.location.tz_id);
                }
            }
            
            localStorage.setItem('weatherAppTheme', theme);
            
            // Update toggle button icon
            const currentTheme = THEMES.find(t => t.value === theme) || THEMES[0];
            weatherElements.themeToggle.textContent = currentTheme.emoji;
        }

        function setThemeBasedOnTime(sunrise, sunset, timezone) {
            if (!sunrise || !sunset || !timezone) return;
            
            try {
                const now = new Date();
                const options = { timeZone: timezone, hour12: false };
                const localTimeStr = now.toLocaleTimeString('en-US', options);
                const [hours, minutes] = localTimeStr.split(':');
                
                const sunriseParts = sunrise.split(':');
                const sunsetParts = sunset.split(':');
                
                const sunriseDate = new Date();
                sunriseDate.setHours(parseInt(sunriseParts[0], 10));
                sunriseDate.setMinutes(parseInt(sunriseParts[1], 10));
                
                const sunsetDate = new Date();
                sunsetDate.setHours(parseInt(sunsetParts[0], 10));
                sunsetDate.setMinutes(parseInt(sunsetParts[1], 10));
                
                const currentDate = new Date();
                currentDate.setHours(parseInt(hours, 10));
                currentDate.setMinutes(parseInt(minutes, 10));
                
                const isNight = currentDate < sunriseDate || currentDate >= sunsetDate;
                document.body.classList.toggle('night-mode', isNight);
                document.body.classList.remove('light-mode', 'dark-mode');
            } catch (e) {
                console.error('Błąd ustawiania motywu:', e);
            }
        }

        function toggleTheme() {
            const currentIndex = THEMES.findIndex(t => t.value === themeMode);
            const nextIndex = (currentIndex + 1) % THEMES.length;
            setTheme(THEMES[nextIndex].value);
        }
		
		
		
		// Funkcje do aktualizacji widgetów
        async function updateCurrentWeatherWidget(data) {
    if (!data) return;
    
    const weatherCode = data.condition?.code || 1000;
    const isDay = data.is_day !== 0;
    const condition = translateWeatherCondition(weatherCode, isDay);
    
    // Aktualizuj wartości
    document.getElementById('widgetTemp').textContent = data.temp_c ? `${data.temp_c.toFixed(1)}°C` : '-';
    document.getElementById('widgetCondition').textContent = condition;
    document.getElementById('widgetWind').textContent = data.wind_kph ? `${data.wind_kph} km/h` : '-';
    document.getElementById('widgetHumidity').textContent = data.humidity ? `${data.humidity}%` : '-';
    
    // Aktualizuj ikonę (dynamicznie z API)
    const iconContainer = document.getElementById('widgetIcon');
    if (iconContainer) {
        try {
            const icon = await getWeatherIcon(weatherCode, isDay);
            iconContainer.innerHTML = '';
            
            // Dostosuj rozmiar ikony dla widgeta
            if (icon.tagName === 'IMG' || icon.tagName === 'svg') {
                icon.style.width = '70px';
                icon.style.height = '60px';
            }
            iconContainer.appendChild(icon);
        } catch (error) {
            console.error('Błąd ładowania ikony:', error);
            // Fallback na emoji jeśli ikona się nie załaduje
            iconContainer.innerHTML = getWeatherEmoji(weatherCode, isDay);
        }
    }
}

      function updateSunWidget(astroData, shortestDay, longestDay) {
    if (!astroData || !astroData.sunrise || !astroData.sunset) return;
    
    const sunriseTime = parseSunTime(astroData.sunrise) || '-';
    const sunsetTime = parseSunTime(astroData.sunset) || '-';
    
    document.getElementById('widgetSunrise').textContent = sunriseTime;
    document.getElementById('widgetSunset').textContent = sunsetTime;
    
    const sunrise = parseSunTime(astroData.sunrise);
    const sunset = parseSunTime(astroData.sunset);
    
    if (sunrise && sunset) {
        // Oblicz długość dnia
        const [sunriseH, sunriseM] = sunrise.split(':').map(Number);
        const [sunsetH, sunsetM] = sunset.split(':').map(Number);
        const dayMinutes = (sunsetH * 60 + sunsetM) - (sunriseH * 60 + sunriseM);
        const hours = Math.floor(dayMinutes / 60);
        const minutes = dayMinutes % 60;
        document.getElementById('widgetDayLength').textContent = `Długość dnia: ${hours}h ${minutes}m`;
        
        // Oblicz pozycję słońca na osi czasu
        const now = new Date();
        const nowMinutes = now.getHours() * 60 + now.getMinutes();
        const sunriseMinutes = sunriseH * 60 + sunriseM;
        const sunsetMinutes = sunsetH * 60 + sunsetM;
        
        let sunPosition = 0;
        if (nowMinutes >= sunriseMinutes && nowMinutes <= sunsetMinutes) {
            sunPosition = ((nowMinutes - sunriseMinutes) / (sunsetMinutes - sunriseMinutes)) * 100;
        }
        
        document.querySelector('.sun-progress').style.width = `${sunPosition}%`;
        document.querySelector('.sun-icon').style.left = `${sunPosition}%`;
        
        // Oblicz różnicę względem najkrótszego/najdłuższego dnia
        if (shortestDay && longestDay && shortestDay.h !== undefined && longestDay.h !== undefined) {
            const shortestMinutes = shortestDay.h * 60 + shortestDay.m;
            const longestMinutes = longestDay.h * 60 + longestDay.m;
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            
            // Dokładniejsze daty przesileń
            const summerSolstice = new Date(currentYear, 5, 21); // 21 czerwca
            const winterSolstice = new Date(currentYear, 11, 21); // 21 grudnia
            
            let differenceText = '';
            
            // Sprawdź czy dzisiaj jest przesilenie letnie (z tolerancją +/- 1 dzień)
            if (Math.abs(currentDate - summerSolstice) <= 86400000) { // 86400000 ms = 1 dzień
                differenceText = ", najdłuższy dzień w roku! ";
            } 
            // Sprawdź czy dzisiaj jest przesilenie zimowe (z tolerancją +/- 1 dzień)
            else if (Math.abs(currentDate - winterSolstice) <= 86400000) {
                differenceText = ", najkrótszy dzień w roku! ";
            } 
            // Okres od przesilenia zimowego do letniego - dni się wydłużają
            else if ((currentDate > winterSolstice && currentDate < summerSolstice) || 
                    (currentDate.getMonth() < 5 || currentDate.getMonth() > 11)) {
                const diff = dayMinutes - shortestMinutes;
                if (diff > 0) {
                    const diffH = Math.floor(diff / 60);
                    const diffM = diff % 60;
                    differenceText = `, dłuższy od najkrótszego o ${diffH}h ${diffM}m`;
                }
            } 
            // Okres od przesilenia letniego do zimowego - dni się skracają
            else {
                const diff = longestMinutes - dayMinutes;
                if (diff > 0) {
                    const diffH = Math.floor(diff / 60);
                    const diffM = diff % 60;
                    differenceText = `, krótszy od najdłuższego o ${diffH}h ${diffM}m`;
                }
            }
            
            document.getElementById('dayDifference').textContent = differenceText || "Brak różnicy";
        }
    }
}

        function updateMoonWidget(astroData) {
            if (!astroData) return;
            
            document.getElementById('moonrise').textContent = parseSunTime(astroData.moonrise) || '-';
            document.getElementById('moonset').textContent = parseSunTime(astroData.moonset) || '-';
            
            // Prosta interpretacja fazy księżyca
            if (astroData.moon_phase) {
                const phase = astroData.moon_phase.toLowerCase();
                let phaseName = '';
                let phaseIcon = '🌑';
                
                if (phase.includes('new')) {
                    phaseName = 'Nów';
                    phaseIcon = '🌑';
                } else if (phase.includes('waxing crescent')) {
                    phaseName = 'Przybywający sierp';
                    phaseIcon = '🌒';
                } else if (phase.includes('first quarter')) {
                    phaseName = 'Pierwsza kwadra';
                    phaseIcon = '🌓';
                } else if (phase.includes('waxing gibbous')) {
                    phaseName = 'Przybywający garb';
                    phaseIcon = '🌔';
                } else if (phase.includes('full')) {
                    phaseName = 'Pełnia';
                    phaseIcon = '🌕';
                } else if (phase.includes('waning gibbous')) {
                    phaseName = 'Ubywający garb';
                    phaseIcon = '🌖';
                } else if (phase.includes('last quarter')) {
                    phaseName = 'Ostatnia kwadra';
                    phaseIcon = '🌗';
                } else if (phase.includes('waning crescent')) {
                    phaseName = 'Ubywający sierp';
                    phaseIcon = '🌘';
                } else {
                    phaseName = 'Nieznana';
                }
                
                document.getElementById('moonPhase').textContent = phaseName;
                document.getElementById('moonPhaseIcon').textContent = phaseIcon;
            }
        }
		
		

// Ulepszona funkcja dla widgetu opadów
function updatePrecipitationWidget(hourlyForecast) {
    const summary = document.getElementById('precipitationSummary');
    
    if (!hourlyForecast || hourlyForecast.length === 0) {
        summary.innerHTML = 'Brak danych o opadach';
        return;
    }

    const now = new Date();
    const next24Hours = hourlyForecast
        .filter(hour => new Date(hour.time) >= now)
        .slice(0, 24);

    // Sprawdź czy są znaczące opady
    const hasSignificantPrecip = next24Hours.some(hour => 
        hour.precip_mm > 0.5 || hour.chance_of_rain > 30 || hour.chance_of_snow > 30
    );

    if (!hasSignificantPrecip) {
        summary.innerHTML = 'Brak znaczących opadów w najbliższych 24 godzinach';
        return;
    }

    // Jeśli są opady, wygeneruj wykres i szczegóły
    renderPrecipitationChart(hourlyForecast);
}

// Ulepszona funkcja dla widgetu burzowego
function updateStormWidget(hourlyForecast, alerts) {
    const container = document.getElementById('stormContent');
    container.innerHTML = 'Brak burz w prognozie';
    
    if (!hourlyForecast || hourlyForecast.length === 0) return;

    const now = new Date();
    let stormPeriods = [];
    let hasActiveAlert = false;

    // Sprawdź alerty IMGW
    if (alerts && alerts.alert) {
        hasActiveAlert = alerts.alert.some(alert => 
            alert.headline.toLowerCase().includes('burz') || 
            alert.event.toLowerCase().includes('storm')
        );
    }

    // Znajdź okresy burzowe w prognozie
    hourlyForecast.forEach(hour => {
        const hourTime = new Date(hour.time);
        const isStormHour = hour.condition.text.toLowerCase().includes('burz') || 
                          [1087, 1273, 1276, 1279, 1282].includes(hour.condition.code);
        
        if (isStormHour && hourTime > now) {
            stormPeriods.push(hourTime);
        }
    });

    if (stormPeriods.length > 0 || hasActiveAlert) {
        let html = '<div class="storm-warning">📢 prognozowane są burze 🌩️</div>';
        
        if (stormPeriods.length > 0) {
            // Grupuj godziny burzowe w przedziały czasowe
            let timeRanges = [];
            let currentRange = {start: stormPeriods[0], end: stormPeriods[0]};
            
            for (let i = 1; i < stormPeriods.length; i++) {
                const diffHours = (stormPeriods[i] - currentRange.end) / (1000 * 60 * 60);
                if (diffHours <= 2) { // Grupuj jeśli przerwa mniejsza niż 2 godziny
                    currentRange.end = stormPeriods[i];
                } else {
                    timeRanges.push(currentRange);
                    currentRange = {start: stormPeriods[i], end: stormPeriods[i]};
                }
            }
            timeRanges.push(currentRange);

            // Określ stopień zagrożenia
            let severity = 'niski';
            const maxWind = Math.max(...hourlyForecast
                .filter(h => stormPeriods.some(s => s.getTime() === new Date(h.time).getTime()))
                .map(h => h.wind_kph)
            );
            
            if (maxWind > 50) severity = 'wysoki';
            else if (maxWind > 30) severity = 'umiarkowany';

            // Wygeneruj komunikaty o burzach
            if (timeRanges.length === 1 && timeRanges[0].start.getTime() === timeRanges[0].end.getTime()) {
                // Pojedyncza godzina
                const time = timeRanges[0].start.toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
                html += `<div style="margin: 0.5rem 0;">Burze możliwe o ${time}</div>`;
            } else {
                // Przedział czasowy
                const rangesText = timeRanges.map(range => {
                    const start = range.start.toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
                    const end = range.end.toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
                    return start === end ? `o ${start}` : `od ${start} do ${end}`;
                }).join(', ');
                
                html += `<div style="margin: 0.5rem 0;">Burze możliwe ${rangesText}</div>`;
            }

            html += `<div style="margin: 0.5rem 0;">Stopień zagrożenia: ${severity}</div>`;
        }

        if (hasActiveAlert) {
            html += `<div style="margin: 0.5rem 0; font-weight: 600;">⚠️ Aktywne ostrzeżenie IMGW, Severe-Weather, MeteoAlarm, NWS!!! Sprawdź szczegóły w sekcji "ostrzeżenia pogodowe"</div>`;
        }

        html += `
            <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                🛡️ Zalecenia: zamknij okna, zabezpiecz przedmioty na balkonie, unikaj otwartej przestrzeni.
            </div>
        `;

        container.innerHTML = html;
    }
}
let precipitationChart = null;

function renderPrecipitationChart(hourlyForecast) {
    const ctx = document.getElementById('precipitationChart').getContext('2d');
    const now = new Date();
    const next24Hours = hourlyForecast
        .filter(hour => new Date(hour.time) >= now)
        .slice(0, 24);
    
    // Przygotuj dane
    const labels = next24Hours.map(hour => 
        new Date(hour.time).toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit', hour12: false})
    );
    
    const data = next24Hours.map(hour => hour.precip_mm);
    const precipTypes = next24Hours.map(hour => {
        if (hour.chance_of_snow > hour.chance_of_rain) return 'śnieg';
        if (hour.chance_of_snow > 0 && hour.chance_of_rain > 0) return 'deszcz ze śniegiem';
        if (hour.chance_of_rain > 0) return 'deszcz';
        return 'brak';
    });

    // Grupuj okresy opadów
    let precipitationPeriods = [];
    let currentPeriod = null;

    next24Hours.forEach((hour, index) => {
        const precipType = hour.chance_of_snow > hour.chance_of_rain ? 'śnieg' : 'deszcz';
        const precipIntensity = getPrecipitationIntensity(hour.precip_mm, precipType);
        
        if (precipIntensity !== 'brak') {
            if (!currentPeriod || 
                currentPeriod.type !== precipType || 
                currentPeriod.intensity !== precipIntensity) {
                if (currentPeriod) precipitationPeriods.push(currentPeriod);
                currentPeriod = {
                    start: index,
                    end: index,
                    type: precipType,
                    intensity: precipIntensity
                };
            } else {
                currentPeriod.end = index;
            }
        } else if (currentPeriod) {
            precipitationPeriods.push(currentPeriod);
            currentPeriod = null;
        }
    });

    if (currentPeriod) precipitationPeriods.push(currentPeriod);

    // Aktualizuj podsumowanie
    updatePrecipitationSummary(precipitationPeriods, labels);

    // Utwórz wykres
    if (precipitationChart) precipitationChart.destroy();
    
    precipitationChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Opady (mm)',
                data: data,
                backgroundColor: precipTypes.map(type => {
                    if (type === 'śnieg') return '#a0d8f3';
                    if (type === 'deszcz ze śniegiem') return '#7db1d5';
                    return '#3498db';
                }),
                borderColor: '#2980b9',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'mm' } },
                x: { grid: { display: false } }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const hour = next24Hours[context.dataIndex];
                            const type = hour.chance_of_snow > hour.chance_of_rain ? 'śnieg' : 'deszcz';
                            return [
                                `Opad: ${context.raw} mm`,
                                `Typ: ${precipTypes[context.dataIndex]}`,
                                `Intensywność: ${getPrecipitationIntensity(hour.precip_mm, type)}`
                            ];
                        }
                    }
                }
            }
        }
    });
}

function getPrecipitationIntensity(amount, type) {
    if (type === 'śnieg') {
        if (amount < 0.5) return 'słabe opady śniegu';
        if (amount < 2) return 'umiarkowany śnieg';
        return 'intensywny śnieg';
    } else {
        if (amount < 1) return 'przelotny deszcz';
        if (amount < 2) return 'słaby deszcz';
        if (amount < 5) return 'deszcz';
        if (amount < 10) return 'umiarkowany deszcz';
        return 'ulewa';
    }
}

function updatePrecipitationSummary(periods, labels) {
    const summary = document.getElementById('precipitationSummary');
    
    if (periods.length === 0) {
        summary.innerHTML = 'Brak znaczących opadów w najbliższych 24 godzinach';
        return;
    }
    
    let html = periods.map(period => {
        const startTime = labels[period.start];
        const endTime = labels[period.end];
        return `
            <div class="precipitation-period">
                <strong>${formatPrecipType(period.type)}</strong> (${period.intensity}): 
                ${startTime} - ${endTime}
            </div>
        `;
    }).join('');
    
    summary.innerHTML = html;
}

function formatPrecipType(type) {
    const types = {
        'deszcz': 'Deszcz',
        'śnieg': 'Śnieg',
        'deszcz ze śniegiem': 'Deszcz ze śniegiem'
    };
    return types[type] || type;
}
        // W funkcji updateAlertsWidget() zmień na:
function updateAlertsWidget(alerts) {
    const alertsContainer = document.getElementById('widgetAlerts');
    
    if (!alerts || !alerts.alert || alerts.alert.length === 0) {
        alertsContainer.innerHTML = 'Brak aktywnych ostrzeżeń';
        return;
    }
    
    // Ogranicz do 1 najważniejszych ostrzeżeń
    const importantAlerts = alerts.alert.slice(0, 1);
    alertsContainer.innerHTML = '';
    
    importantAlerts.forEach(async (alert) => {
        const alertElement = document.createElement('div');
        alertElement.style.marginBottom = '0.5rem';
        alertElement.style.paddingBottom = '0.5rem';
        alertElement.style.borderBottom = '1px solid rgba(0,0,0,0.1)';
        
        const lang = detectWarningLanguage(alert.headline || alert.description);
        const details = extractWarningDetails(alert, lang);
        
        // Dodaj tłumaczenie
        let translatedHeadline = alert.headline;
        if (lang !== 'pl') {
            translatedHeadline = await translateWarning(alert.headline, lang);
        }
        
        alertElement.innerHTML = `
            <div style="display:flex; align-items:center; gap:0.5rem;">
                <span>${details.type.emoji}</span>
                <strong>${details.type.name}</strong>
            </div>
            <div style="font-size:0.8rem; margin-top:0.2rem;">${translatedHeadline || details.type.description}</div>
        `;
        
        alertsContainer.appendChild(alertElement);
    });
    
    if (alerts.alert.length > 3) {
        const moreElement = document.createElement('div');
        moreElement.style.marginTop = '0.5rem';
        moreElement.style.fontSize = '0.8rem';
        moreElement.style.opacity = '0.7';
        moreElement.textContent = `+ ${alerts.alert.length - 3} więcej...`;
        alertsContainer.appendChild(moreElement);
    }
}
function calculateSolsticeTimes(year) {
    // Uproszczone obliczenia przesileń (dokładne wymagają bardziej złożonych obliczeń)
    // Przesilenie zimowe ~21 grudnia
    const winterSolstice = new Date(year, 11, 21);
    // Przesilenie letnie ~21 czerwca
    const summerSolstice = new Date(year, 5, 21);
    
    return { winterSolstice, summerSolstice };
}

        async function updateUI(data) {
		
		
            if (!data || !data.location || !data.current || !data.forecast) {
                console.error('Nieprawidłowe dane:', data);
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Błąd ładowania danych pogodowych</span>
                        </div>
                    </div>
                `;
                return;
            }
			

            const { location, current, forecast, alerts } = data;
            const isDay = current.is_day !== 0;
    const weatherCode = current.condition?.code || 1000;

            weatherElements.currentCity.textContent = location.name || 'Nieznana lokalizacja';
              weatherElements.currentCondition.textContent = translateWeatherCondition(weatherCode, isDay);
            weatherElements.tempNow.textContent = current.temp_c ? `${current.temp_c.toFixed(1)}°C` : '-';
            weatherElements.windNow.textContent = current.wind_kph ? `${current.wind_kph} km/h` : '-';
            weatherElements.pressureNow.textContent = current.pressure_mb ? `${current.pressure_mb} hPa` : '-';
            weatherElements.humidityNow.textContent = current.humidity ? `${current.humidity}%` : '-';

            await updateCurrentWeatherIcon(current.condition?.code || 1000, isDay);

            if (forecast.forecastday?.[0]?.astro) {
    const sunrise = parseSunTime(forecast.forecastday[0].astro.sunrise);
    const sunset = parseSunTime(forecast.forecastday[0].astro.sunset);
    weatherElements.sunriseTime.textContent = sunrise;
    weatherElements.sunsetTime.textContent = sunset;
    
    // Aktualizuj motyw tylko jeśli jest w trybie auto
    if (themeMode === 'auto') {
        setThemeBasedOnTime(sunrise, sunset, location.tz_id);
    }

    // DODAJ TUTAJ NOWY KOD //
    // Oblicz najkrótszy i najdłuższy dzień w roku
    const currentYear = new Date().getFullYear();
    const shortestDay = { h: 7, m: 42 }; // 21 grudnia
    const longestDay = { h: 16, m: 48 }; // 21 czerwca
	updateSunWidget(forecast.forecastday[0].astro, shortestDay, longestDay);
            }
			
			
			
			
    
     if (data.forecast?.forecastday?.[0]?.hour) {
         renderPrecipitationChart(data.forecast.forecastday[0].hour);
        updateStormWidget(data.forecast.forecastday[0].hour, data.alerts);
        updateFrostWidget(data.forecast.forecastday[0].hour, data.alerts);
		updatePrecipitationWidget(data.forecast.forecastday[0].hour);
        renderTemperatureChart(data.forecast.forecastday[0].hour);
    }

            if (current.air_quality) {
                const aqi = current.air_quality['us-epa-index'] || 0;
                const airQualityAdvice = getAirQualityAdvice(aqi);
                weatherElements.airQualityAdvice.innerHTML = `
                    <strong>${airQualityAdvice.label}</strong><br>
                    ${airQualityAdvice.text}<br>
                    <span class="air-quality-emoji">${airQualityAdvice.emoji}</span>
                `;
                weatherElements.aqiValue.textContent = aqi;
                weatherElements.pm25Value.textContent = current.air_quality.pm2_5?.toFixed(1) || '-';
                weatherElements.pm10Value.textContent = current.air_quality.pm10?.toFixed(1) || '-';
                
                // Update AQI color
                weatherElements.aqiItem.className = `parameter-item aqi-${aqi}`;
            }
			
			
        

            // Update weather summary
            weatherElements.weatherSummary.style.display = 'block';
            weatherElements.weatherSummaryText.textContent = generateWeatherSummary(forecast);
            
            // Update runner tip with storm forecast check
            const runnerTip = getRunnerTip(
                current.condition?.text, 
                current.temp_c, 
                forecast.forecastday[0]?.day?.totalprecip_mm || 0,
                data
            );
            
            weatherElements.runnerTip.style.display = 'block';
            weatherElements.runnerTipText.innerHTML = `
                <strong>${runnerTip.title}</strong><br>
                ${typeof runnerTip.text === 'function' ? runnerTip.text() : runnerTip.text}
            `;

            await updateHourlyForecast(forecast.forecastday?.[0]?.hour, isDay);
            await updateDailyForecast(forecast.forecastday);
            await updateWarnings(alerts);
            
            lastWeatherData = data;
			// Aktualizacja widgetów
updateCurrentWeatherWidget(data.current);

if (data.forecast.forecastday?.[0]?.astro) {
    updateSunWidget(data.forecast.forecastday[0].astro);
    updateMoonWidget(data.forecast.forecastday[0].astro);
}

if (data.alerts) {
    updateAlertsWidget(data.alerts);
}
        }
		

        async function showWeather(position) {
            try {
                const coords = position.coords;
                currentLat = coords.latitude;
                currentLon = coords.longitude;
                const weatherData = await getWeatherData(coords.latitude, coords.longitude);
                if (weatherData) {
                    updateUI(weatherData);
                }
            } catch (error) {
                console.error('Błąd geolokalizacji:', error);
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Błąd pobierania danych: ${error.message}</span>
                        </div>
                    </div>
                `;
            }
        }

        async function searchLocation() {
            const city = weatherElements.locationInput.value.trim();
            if (!city) {
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">⚠️</span>
                            <span class="warning-title">Wpisz nazwę miasta</span>
                        </div>
                    </div>
                `;
                return;
            }

            try {
                showLoading(true);
                const coords = await getCoordinates(city);
                if (!coords) return;

                const weatherData = await getWeatherData(coords.lat, coords.lon);
                if (weatherData) {
                    weatherData.location.name = coords.name;
                    weatherData.location.tz_id = coords.timezone;
                    updateUI(weatherData);
                }
            } catch (error) {
                console.error('Błąd wyszukiwania:', error);
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Błąd wyszukiwania: ${error.message}</span>
                        </div>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                searchLocation();
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">🔄</span>
                            <span class="warning-title">Wyszukiwanie Twojej lokalizacji...</span>
                        </div>
                    </div>
                `;
                
                navigator.geolocation.getCurrentPosition(
                    showWeather, 
                    (error) => {
                        let errorMessage = 'Nie udało się uzyskać lokalizacji';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Brak uprawnień do geolokalizacji';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Informacje o lokalizacji niedostępne';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Przekroczono czas oczekiwania na lokalizację';
                                break;
                        }
                        weatherElements.weatherWarnings.innerHTML = `
                            <div class="warning-card">
                                <div class="warning-header">
                                    <span class="warning-icon">❌</span>
                                    <span class="warning-title">${errorMessage}. Wyszukaj miasto ręcznie.</span>
                                </div>
                            </div>
                        `;
                    },
                    { 
                        enableHighAccuracy: true, 
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Twoja przeglądarka nie wspiera geolokalizacji. Wyszukaj miasto ręcznie.</span>
                        </div>
                    </div>
                `;
            }
        }

        async function getCoordinates(city) {
            try {
                showLoading(true);
                const response = await fetch(
                    `https://api.weatherapi.com/v1/search.json?key=${API_KEY}&q=${city}`
                );
                const data = await response.json();
                
                if (!data || data.error || data.length === 0) {
                    throw new Error(data?.error?.message || 'Nie znaleziono miasta');
                }
                
                const location = data[0];
                return { 
                    lat: location.lat, 
                    lon: location.lon, 
                    name: location.name, 
                    timezone: location.tz_id 
                };
            } catch (error) {
                console.error('Błąd geokodowania:', error);
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Nie znaleziono miasta: ${error.message}</span>
                        </div>
                    </div>
                `;
                return null;
            } finally {
                showLoading(false);
            }
        }

        async function getWeatherData(lat, lon) {
            try {
                showLoading(true);
                const response = await fetch(
                    `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${lat},${lon}&days=4&aqi=yes&alerts=yes&lang=pl`
                );
                const data = await response.json();
                
                if (!data || data.error) {
                    throw new Error(data?.error?.message || 'Błąd pobierania danych');
                }
                
                lastWeatherData = data;
                return data;
            } catch (error) {
                console.error('Błąd API:', error);
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">❌</span>
                            <span class="warning-title">Błąd ładowania danych: ${error.message}</span>
                        </div>
                    </div>
                `;
                return null;
            } finally {
                showLoading(false);
            }
        }

        function parseSunTime(time) {
            if (!time) return null;
            // Remove AM/PM if present and convert to 24-hour format
            const timeStr = time.replace(/\s/g, '').toUpperCase();
            
            if (timeStr.includes('AM') || timeStr.includes('PM')) {
                const [timePart, period] = timeStr.split(/(AM|PM)/);
                let [hours, minutes] = timePart.split(':');
                
                hours = parseInt(hours, 10);
                if (period === 'PM' && hours < 12) {
                    hours += 12;
                } else if (period === 'AM' && hours === 12) {
                    hours = 0;
                }
                
                return `${hours.toString().padStart(2, '0')}:${minutes}`;
            }
            
            // If already in 24-hour format
            const [hours, minutes] = timeStr.split(':');
            return `${hours.padStart(2, '0')}:${minutes}`;
        }

        // Inicjalizacja
        function init() {
            // Load saved theme preference
            const savedTheme = localStorage.getItem('weatherAppTheme');
            if (savedTheme) {
                setTheme(savedTheme);
				
            }
			

            
            // Create theme selector
            createThemeSelector();
            
            // Set up theme toggle
            weatherElements.themeToggle.addEventListener('click', toggleTheme);
			
			
			function initWarningCards() {
    document.addEventListener('click', function(e) {
        if (e.target.closest('.warning-header')) {
            const card = e.target.closest('.warning-card');
            card.classList.toggle('expanded');
            
            // Jeśli to ważne ostrzeżenie (red), dodaj animację
            if (card.classList.contains('red')) {  // Poprawione - brakujący nawias
                card.classList.add('important');
            }
        }
    });
}
            
            if (navigator.geolocation) {
                getLocation();
            } else {
                weatherElements.weatherWarnings.innerHTML = `
                    <div class="warning-card">
                        <div class="warning-header">
                            <span class="warning-icon">ℹ️</span>
                            <span class="warning-title">Geolokalizacja niedostępna. Wpisz miasto.</span>
                        </div>
                    </div>
                `;
            }
        }

        init();
    </script>
	<div class="widget-toggle" onclick="toggleWidgets()">📊 Widgety</div>
</body>
</html>